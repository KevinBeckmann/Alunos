<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Meta tags PWA adicionadas para instalabilidade -->
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Dashboard do Aluno - Acompanhe seu treino, medidas e progresso">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Dashboard Aluno">
    
    <!-- Link para o manifest.json -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Ícones para dispositivos Apple -->
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    
    <title>Dashboard do Aluno - Dark Mode</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>

    <style>
        /* --- ESTILOS GERAIS --- */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #000000;
            color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        nav {
            width: 100%;
            max-width: 1200px;
            text-align: right;
            margin-bottom: 10px;
        }

        nav a {
            color: #ff8c00;
            text-decoration: none;
            font-size: 0.9em;
        }

        /* HEADER */
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
            gap: 20px;
            text-align: center;
            max-width: 100%;
        }

        .header-content img {
            max-width: 80px;
            height: auto;
            border-radius: 10px;
        }

        .header-content h1 {
            color: #ff8c00;
            margin: 0;
            font-size: 2.2em;
            line-height: 1.2;
        }

        /* LAYOUT RESPONSIVO (GRID) */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            gap: 20px;
            width: 100%;
            justify-content: center;
            grid-template-columns: 1fr;
        }

        @media (min-width: 768px) {
            .container {
                grid-template-columns: 1fr 1fr;
            }
            #chart-card {
                grid-column: 1 / 3;
                order: 1;
            }
        }

        @media (min-width: 1024px) {
            .container {
                grid-template-columns: 1fr 1fr 1fr;
            }
            #chart-card {
                grid-column: auto;
                order: initial;
            }
        }

        /* CARDS */
        .card {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #medidas-card {
            order: 2;
        }

        /* FORMULÁRIOS E INPUTS */
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            justify-content: space-between;
        }

        .input-group label {
            width: 95px;
            flex-shrink: 0;
            font-size: 0.9em;
            color: #ccc;
        }

        #medidas-card .input-container {
            max-width: 350px;
            margin: 0 auto 15px auto;
        }

        #medidas-card .input-group {
            width: 100%;
        }

        .input-group input,
        select {
            flex-grow: 1;
            padding: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #f0f0f0;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }

        select {
            margin-bottom: 15px;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23ff9933" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 8px center;
            padding-right: 30px;
        }

        select option {
            background-color: #1a1a1a;
        }

        h2 {
            color: #ff9933;
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin-bottom: 20px;
        }

        /* LISTA DE TREINO */
        .exercicio-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: background-color 0.3s;
        }

        .exercicio-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .exercicio-info strong {
            font-size: 1.1em;
            display: block;
            margin-bottom: 5px;
        }

        .checkbox-container input[type="checkbox"] {
            transform: scale(1.3);
            cursor: pointer;
        }

        .concluido {
            background-color: #387038;
            opacity: 0.7;
            text-decoration: line-through;
            color: #a0a0a0;
        }

        /* TABELA PRESENÇA */
        .presenca-table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
        }

        .presenca-table th,
        .presenca-table td {
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px;
            cursor: pointer;
        }

        .presenca-table th {
            background-color: #ff8c00;
            color: white;
        }

        .presente {
            background-color: #5cb85c !important;
            color: white;
        }

        /* BOTÕES */
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-primary {
            background-color: #ffc107;
            color: #333;
        }

        .btn-primary:hover {
            background-color: #e0a800;
        }

        .reset-btn {
            margin-top: 15px;
            background-color: #dc3545;
            color: white;
        }

        .reset-btn:hover {
            background-color: #c9302c;
        }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #0d0d0d;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 2px solid #ff8c00;
        }

        .modal-content img {
            max-width: 100px;
            margin-bottom: 20px;
        }

        #botaoSalvarNome {
            background-color: #ff8c00;
            color: #000;
            margin-top: 10px;
        }

        /* --- CAMPO DE PESQUISA IA --- */
        #ai-search-card {
            order: 3;
            background-color: #1a1a1a;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #ai-search-card textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background-color: #000000;
            color: #f0f0f0;
            resize: vertical;
            box-sizing: border-box;
        }

        #ai-resposta {
            margin-top: 15px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: transparent;
            border-radius: 8px;
            min-height: 50px;
            font-size: 0.9em;
            color: #ccc;
            white-space: pre-wrap;
        }

        #ai-resposta strong {
            color: #ff9933;
        }
    </style>
</head>

<body onload="obterNomeAluno()">

    <nav>
        <a href="professor.html">Acessar a Página do Professor</a>
    </nav>

    <div id="modal-nome" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <img src="logotipo.png" alt="Logo PTF3" onerror="this.style.display='none'">
            <h3>Bem-vindo(a)!</h3>
            <p>Por favor, insira seu nome:</p>
            <input type="text" id="nomeModalInput" placeholder="Ex: Maria da Silva"
    style="
        width: 100%;
        padding: 12px;
        margin-bottom: 12px;
        background-color: rgba(255,255,255,0.08);
        color: #f0f0f0;
        text-align: center;
        border: 1px solid rgba(255,255,255,0.3);
        border-radius: 6px;
        display: block;
        box-sizing: border-box;
    ">

            <button id="botaoSalvarNome" onclick="salvarNomeModal()">Entrar</button>
        </div>
    </div>

    <div class="header-content">
        <img src="logotipo.png" alt="Logo PTF3" onerror="this.style.display='none'">
        <h1 id="main-title">Seja bem-vindo ao seu Espaço.</h1>
    </div>

    <div class="container">

        <div id="chart-card" class="card">
            <h2> Progressão de Carga</h2>
            <label for="seletorExercicio">Visualizar Exercício:</label>
            <select id="seletorExercicio" onchange="inicializarGrafico()">
                <option value="AgachamentoLivre">Agachamento Livre</option>
                <option value="SupinoReto">Supino Reto</option>
                <option value="PuxadaFrontal">Puxada Frontal</option>
                <option value="RoscaDireta">Rosca Direta</option>
                <option value="TricepsTesta">Tríceps Testa</option>
                <option value="DesenvolvimentoMilitar">Desenvolvimento Militar</option>
                <option value="CadeiraExtensora">Cadeira Extensora</option>
                <option value="ElevacaoPelvica">Elevação Pélvica</option>
            </select>

            <div class="chart-container">
                <canvas id="pesoChart"></canvas>
            </div>

            <div class="input-group">
                <input type="number" id="pesoInput" placeholder="Carga (kg)" step="0.5">
                <button class="btn-primary" onclick="adicionarPeso()">Registrar Carga</button>
            </div>
            <button class="reset-btn" onclick="resetarDados('cargas')">Resetar Histórico</button>
        </div>

        <div id="medidas-card" class="card">
            <h2> Registro de Medidas</h2>
            <p style="margin-bottom: 15px; font-size: 0.9em; color: #ccc; text-align: center;">Acompanhe sua evolução.
            </p>

            <div class="input-container">
                <div class="input-group"><label>Peso (kg)</label><input type="number" id="pesoCorporalInput"
                        placeholder="Ex: 75.5" step="0.1"></div>
                <div class="input-group"><label>Cintura</label><input type="number" id="cinturaInput" placeholder="cm"
                        step="1"></div>
                <div class="input-group"><label>Braço D.</label><input type="number" id="bracoInput" placeholder="cm"
                        step="0.5"></div>
                <div class="input-group"><label>Tórax</label><input type="number" id="toraxInput" placeholder="cm"
                        step="1">
                </div>
                <div class="input-group"><label>Abdômen</label><input type="number" id="abdomenInput" placeholder="cm"
                        step="1"></div>
                <div class="input-group"><label>Coxa D.</label><input type="number" id="coxaInput" placeholder="cm"
                        step="0.5"></div>
                <div class="input-group"><label>Panturrilha</label><input type="number" id="panturrilhaInput"
                        placeholder="cm" step="0.5"></div>
                <div class="input-group"><label>Antebraço</label><input type="number" id="antebracoInput"
                        placeholder="cm" step="0.5"></div>
            </div>

            <button class="btn-primary" onclick="registrarMedidas()">Registrar Medidas</button>

            <h3 style="margin-top: 15px; color: #ff9933; text-align: center;">Últimos Registros</h3>
            <div id="ultimasMedidas" style="font-size: 0.9em; color: #ccc; text-align: center;">Nenhum registro
                encontrado.</div>
            <button class="reset-btn" onclick="resetarDados('medidas')">Resetar Medidas</button>
        </div>

        <div id="treino-card" class="card">
            <h2> Treino de Força</h2>

            <label for="seletorTreino">Selecionar Dia:</label>
            <select id="seletorTreino" onchange="alternarTreino()">
                <option value="Dia A">Dia A </option>
                <option value="Dia B">Dia B </option>
                <option value="Dia C">Dia C </option>
            </select>
            <hr style="border-color: rgba(255, 255, 255, 0.2);">

            <p style="text-align: center;"><strong>Aluno:</strong> <span id="nome-aluno" style="color:#ff8c00">...</span>
                | <strong>Data:</strong>
                <span id="data-atual"></span></p>

            <div id="treino-Dia A" class="lista-treino-dia">
                <h3>Dia A: </h3>
                <ul id="lista-treino-a" style="list-style: none; padding: 0;">
                    <li class="exercicio-item" style="background: none; border: none; color: #ff9933;">Carregando treino...
                    </li>
                </ul>
            <div style="margin-top:10px;"><button class="btn-primary btn-finalizar-treino" onclick="finalizarTreino()">Finalizar Treino</button></div>
            </div>

            <div id="treino-Dia B" class="lista-treino-dia" style="display: none;">
                <h3>Dia B: </h3>
                <ul id="lista-treino-b" style="list-style: none; padding: 0;">
                    <li class="exercicio-item" style="background: none; border: none; color: #ff9933;">Carregando treino...
                    </li>
                </ul>
            <div style="margin-top:10px;"><button class="btn-primary btn-finalizar-treino" onclick="finalizarTreino()">Finalizar Treino</button></div>
            </div>

            <div id="treino-Dia C" class="lista-treino-dia" style="display: none;">
                <h3>Dia C: </h3>
                <ul id="lista-treino-c" style="list-style: none; padding: 0;">
                    <li class="exercicio-item" style="background: none; border: none; color: #ff9933;">Carregando treino...
                    </li>
                </ul>
            <div style="margin-top:10px;"><button class="btn-primary btn-finalizar-treino" onclick="finalizarTreino()">Finalizar Treino</button></div>
            </div>
        </div>

        <div id="ai-search-card" class="card">
            <h2> IA PTF3</h2>

            <label for="exercicioPergunta">O que você gostaria de saber sobre o exercício?</label>
            <textarea id="exercicioPergunta" placeholder= "Ex:'Qual a forma correta de fazer agachamento livre?' Ou 'Quais os músculos ativados no supino?'" ></textarea>

            <button class="btn-primary" onclick="simularPesquisaIA()">Perguntar à IA</button>

            <h3 style="margin-top: 15px; color: #ff9933; text-align: center;">Resposta da IA</h3>
            <div id="ai-resposta">
                
            </div>
        </div>
        <div id="presenca-card" class="card">
            <h2> Presença Mensal</h2>

            <p style="text-align: center;">Clique nas datas para marcar.</p>
            <table class="presenca-table">
                <thead>
                    <tr>
                        <th>Dom</th>
                        <th>Seg</th>
                        <th>Ter</th>
                        <th>Qua</th>
                        <th>Qui</th>
                        <th>Sex</th>
                        <th>Sáb</th>
                    </tr>
                </thead>
                <tbody id="calendario-body"></tbody>
            </table>
    <div id="status-treino" class="card" style="margin-top:15px; text-align:center;">
        <p id="ultimo-treino" style="color:#ff9933;">Carregando último treino...</p>
        <p id="contador-treinos" style="color:#ffd700; font-weight:bold;">Treinos no mês: 0</p>

        <div style="max-width:640px; margin:10px auto;">
            <canvas id="graficoTreinos" height="200"></canvas>
        </div>

        <div id="lista-historico-treinos" style="max-width:640px; margin:8px auto; color:#ddd; text-align:left;"></div>
    </div>
    
            <button class="reset-btn" onclick="resetarDados('presenca')">Resetar Presenças</button>
        </div>

    </div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('✅ Service Worker registrado com sucesso:', registration.scope);
                    })
                    .catch(error => {
                        console.log('❌ Falha ao registrar Service Worker:', error);
                    });
            });
        }

        // CONFIGURAÇÃO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyQDLkdyL4qgoEj1YqBr2xCs0F3aM1o82ef0",
            authDomain: "ptf03-26fdb.firebaseapp.com",
            databaseURL: "https://ptf03-26fdb-default-rtdb.firebaseio.com",
            projectId: "ptf03-26fdb",
            storageBucket: "ptf03-26fdb.firebaseapp.com",
            messagingSenderId: "1020981883676",
            appId: "1:1020981883676:web:7b26aca25ddb1dc02100d9"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let alunoNome = '';
        let pesoChart;

        function getPath(sub) {
            return `alunos/${alunoNome.replace(/\s/g, '_')}/${sub}`;
        }

        const normalize = (str) => str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();

        const rawData = [
            "Supino Reto | Musculação | Peito | Peitoral Maior, Deltóide Anterior, Tríceps | Deite no banco, pés firmes no chão. Segure a barra na largura dos ombros. Desça-a controladamente até o peito. Empurre a barra para cima, estendendo os braços. | Mantenha as escápulas retraídas (ombros para trás e para baixo) para estabilizar e proteger a articulação do ombro.",
            "Agachamento Livre | Musculação | Pernas/Glúteos | Quadríceps, Glúteo Máximo, Isquiotibiais | Com a barra nas costas, desça o quadril como se fosse sentar em uma cadeira, mantendo o peito alto e a coluna neutra. Os joelhos devem seguir a direção dos pés. | A profundidade ideal é abaixo de 90 graus (se a mobilidade permitir). Distribua o peso nos calcanhares e evite que os joelhos 'caiam' para dentro."
        ];

        const bancoDeExercicios = {};

        rawData.forEach(item => {
            const parts = item.split(' | ');
            if (parts.length === 6) {
                const [nome, modalidade, categoria, musculos, execucao, dica] = parts;
                const key = normalize(nome).replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');
                const searchTerms = [
                    ...nome.split(/\s+/).map(normalize),
                    ...musculos.split(/,\s*/).map(normalize).filter(t => t.length > 2),
                    normalize(categoria),
                    normalize(modalidade)
                ];

                bancoDeExercicios[key] = {
                    nome: nome,
                    modalidade: modalidade,
                    categoria: categoria,
                    musculos: musculos,
                    execucao: execucao,
                    dica: dica,
                    termos: [...new Set(searchTerms.filter(t => t))]
                };
            }
        });

        // ---------- função: finalizarTreino (salva treino finalizado com Firebase SDK) ----------
        function finalizarTreino() {
            try {
                const dia = document.getElementById('seletorTreino') ? document.getElementById('seletorTreino').value : 'Dia A';
                const agora = new Date();
                const dataLegivel = agora.toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit', year:'numeric'});
                const horaLegivel = agora.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

                // coleta checkboxes marcados no treino atual
                let idLista = (dia === 'Dia A') ? 'lista-treino-a' : ((dia === 'Dia B') ? 'lista-treino-b' : 'lista-treino-c');
                const listaEl = document.getElementById(idLista);
                const concluidos = [];
                if (listaEl) {
                    listaEl.querySelectorAll('input[type=\"checkbox\"]').forEach(cb => {
                        if (cb.checked) {
                            let nome = cb.getAttribute('data-nome') || '';
                            if (!nome) {
                                const li = cb.closest('li');
                                if (li) {
                                    const s = li.querySelector('.exercicio-info strong');
                                    if (s) nome = s.textContent.trim();
                                }
                            }
                            if (!nome) nome = 'Exercício marcado';
                            concluidos.push(nome);
                        }
                    });
                }

                const payload = {
                    dia: dia,
                    data: dataLegivel,
                    hora: horaLegivel,
                    timestamp: Date.now(),
                    concluido: true,
                    concluidoCount: concluidos.length,
                    exerciciosConcluidos: concluidos
                };

                const ref = database.ref(getPath('treinosFinalizados')).push();
                ref.set(payload)
                    .then(() => {
                        try { carregarUltimoTreino(); } catch(e){console.warn('carregarUltimoTreino erro',e);}
                        try { contarTreinosDoMes(); } catch(e){console.warn('contarTreinosDoMes erro',e);}
                        try { marcarTreinoNoCalendario(new Date()); } catch(e){console.warn('marcarTreinoNoCalendario erro',e);}
                        try { carregarTreinosFinalizados(); } catch(e){console.warn('carregarTreinosFinalizados erro',e);}
                        // feedback
                        alert('Treino registrado com sucesso!');
                    })
                    .catch(err => {
                        console.error('Erro ao salvar treino finalizado:', err);
                        alert('Erro ao registrar treino. Tente novamente.');
                    });
            } catch(err) {
                console.error('Erro em finalizarTreino():', err);
                alert('Erro ao registrar treino. Tente novamente.');
            }
        }

        // Funções de carregamento e gráfico de treinos finalizados
        function carregarUltimoTreino() {
            try {
                const ref = database.ref(getPath('treinosFinalizados'));
                ref.orderByChild('timestamp').limitToLast(1).on('value', snap => {
                    const p = document.getElementById('ultimo-treino');
                    if (!p) return;
                    if (!snap.exists()) {
                        p.textContent = 'Nenhum treino registrado ainda.';
                        return;
                    }
                    snap.forEach(child => {
                        const t = child.val();
                        p.textContent = `Último treino: ${t.dia} — ${t.data} às ${t.hora}`;
                    });
                });
            } catch (err) { console.warn('carregarUltimoTreino erro', err); }
        }

        function contarTreinosDoMes() {
            try {
                const mesAtual = new Date().getMonth() + 1;
                let total = 0;
                database.ref(getPath('treinosFinalizados')).once('value').then(snap => {
                    snap.forEach(c => {
                        const t = c.val();
                        if (!t || !t.data) return;
                        const parts = t.data.split('/');
                        const mesT = parseInt(parts[1], 10);
                        if (mesT === mesAtual) total++;
                    });
                    const el = document.getElementById('contador-treinos');
                    if (el) el.textContent = `Treinos no mês: ${total}`;
                }).catch(err => console.warn('contarTreinosDoMes erro', err));
            } catch (err) { console.warn('contarTreinosDoMes erro', err); }
        }

        function carregarTreinosFinalizados() {
            try {
                const ref = database.ref(getPath('treinosFinalizados'));
                ref.orderByChild('timestamp').once('value').then(snap => {
                    const lista = [];
                    snap.forEach(c => lista.push(c.val()));
                    // atualizar lista textual
                    const divList = document.getElementById('lista-historico-treinos');
                    if (divList) {
                        if (!lista.length) divList.innerHTML = '<p style="text-align:center;color:#999">Nenhum treino registrado.</p>';
                        else {
                            let html = '<ul style="padding-left:16px;">';
                            lista.slice().reverse().forEach(t => {
                                html += `<li style="margin:6px 0;">${t.data} — ${t.dia} — ${t.concluidoCount || 0} exercícios</li>`;
                            });
                            html += '</ul>';
                            divList.innerHTML = html;
                        }
                    }

                    // agrupamento por data para gráfico
                    const agrupado = {};
                    lista.forEach(t => {
                        const key = t.data || 'Sem data';
                        agrupado[key] = (agrupado[key] || 0) + 1;
                    });
                    renderTreinosBarChart(agrupado);
                }).catch(err => console.warn('carregarTreinosFinalizados erro', err));
            } catch (err) { console.warn('carregarTreinosFinalizados erro', err); }
        }

        let chartTreinos = null;
        function renderTreinosBarChart(dataObj) {
            try {
                const canvas = document.getElementById('graficoTreinos');
                if (!canvas) return;
                const labels = Object.keys(dataObj || {});
                const data = labels.map(l => dataObj[l] || 0);
                if (typeof Chart === 'undefined') { console.warn('Chart.js não carregado'); return; }
                const ctx = canvas.getContext('2d');
                if (chartTreinos) chartTreinos.destroy();
                chartTreinos = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Treinos (por data)',
                            data: data,
                            backgroundColor: 'rgba(255,193,7,0.9)',
                            borderColor: 'rgba(255,193,7,1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { ticks: { color: '#f0f0f0' } },
                            y: { beginAtZero: true, ticks: { color: '#f0f0f0' } }
                        },
                        plugins: { legend: { labels: { color: '#f0f0f0' } } }
                    }
                });
            } catch(err) { console.warn('renderTreinosBarChart erro', err); }
        }

        // marcar treino no calendario
        function marcarTreinoNoCalendario(dataObj) {
            try {
                const dia = String(dataObj.getDate()).padStart(2,'0');
                const mes = String(dataObj.getMonth()+1).padStart(2,'0');
                const ano = dataObj.getFullYear();
                const chave = `${dia}-${mes}-${ano}`;
                database.ref(getPath(`calendario/${chave}`)).set({ treinou: true, timestamp: Date.now() }).catch(e=>console.warn('marcarTreinoNoCalendario erro', e));
            } catch(e){ console.warn('marcarTreinoNoCalendario erro', e); }
        }

        function start() {
            document.getElementById('nome-aluno').textContent = alunoNome;
            document.getElementById('main-title').textContent = `Bem-vindo, ${alunoNome.split(' ')[0]}!`;
            document.getElementById('data-atual').textContent = new Date().toLocaleDateString('pt-BR');

            inicializarGrafico();
            carregarUltimasMedidas();
            alternarTreino();
            gerarCalendario();
        
            carregarUltimoTreino();
            contarTreinosDoMes();
            carregarTreinosFinalizados();
        }

        function obterNomeAluno() {
            // Implementação para obter o nome do aluno
        }

        function salvarNomeModal() {
            // Implementação para salvar o nome do aluno
        }

        function inicializarGrafico() {
            // Implementação para inicializar o gráfico
        }

        function carregarUltimasMedidas() {
            // Implementação para carregar as últimas medidas
        }

        function alternarTreino() {
            // Implementação para alternar entre os dias de treino
        }

        function gerarCalendario() {
            // Implementação para gerar o calendário de presença
        }

        function adicionarPeso() {
            // Implementação para adicionar peso ao gráfico
        }

        function registrarMedidas() {
            // Implementação para registrar medidas
        }

        function resetarDados(tipo) {
            // Implementação para resetar dados
        }

        function simularPesquisaIA() {
            // Implementação para simular pesquisa IA
        }
    </script>
</body>

</html>
