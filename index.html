<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard do Aluno - Dark Mode</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js">
// ---------- fun√ß√£o: finalizarTreino (salva treino finalizado com Firebase SDK) ----------
function finalizarTreino() {
    try {
        const dia = document.getElementById('seletorTreino') ?
document.getElementById('seletorTreino').value : 'Dia A';
        const agora = new Date();
        const dataLegivel = agora.toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit', year:'numeric'});
const horaLegivel = agora.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
// coleta checkboxes marcados no treino atual
        let idLista = (dia === 'Dia A') ?
'lista-treino-a' : ((dia === 'Dia B') ? 'lista-treino-b' : 'lista-treino-c');
        const listaEl = document.getElementById(idLista);
        const concluidos = [];
if (listaEl) {
            listaEl.querySelectorAll('input[type=\"checkbox\"]').forEach(cb => {
                if (cb.checked) {
                    let nome = cb.getAttribute('data-nome') || '';
                    if (!nome) {
                   
const li = cb.closest('li');
                        if (li) {
                            const s = li.querySelector('.exercicio-info strong');
                            if (s) nome = s.textContent.trim();
  
}
                    }
                    if (!nome) nome = 'Exerc√≠cio marcado';
                    concluidos.push(nome);
             
}
            });
}

        const payload = {
            dia: dia,
            data: dataLegivel,
            hora: horaLegivel,
            timestamp: Date.now(),
            concluido: true,
            concluidoCount: concluidos.length,
           
exerciciosConcluidos: concluidos
        };

        const ref = database.ref(getPath('treinosFinalizados')).push();
ref.set(payload)
            .then(() => {
                try { carregarUltimoTreino(); } catch(e){console.warn('carregarUltimoTreino erro',e);}
                try { contarTreinosDoMes(); } catch(e){console.warn('contarTreinosDoMes erro',e);}
                try { marcarTreinoNoCalendario(new Date()); } catch(e){console.warn('marcarTreinoNoCalendario erro',e);}
                try { carregarTreinosFinalizados(); } catch(e){console.warn('carregarTreinosFinalizados erro',e);}
 
// feedback
                alert('Treino registrado com sucesso!');
            })
            .catch(err => {
                console.error('Erro ao salvar treino finalizado:', err);
                alert('Erro ao 
registrar treino. Tente novamente.');
            });
} catch(err) {
        console.error('Erro em finalizarTreino():', err);
        alert('Erro ao registrar treino. Tente novamente.');
}
}


// ---------- Fun√ß√µes de carregamento e gr√°fico de treinos finalizados ----------
function carregarUltimoTreino() {
    try {
        const ref = database.ref(getPath('treinosFinalizados'));
ref.orderByChild('timestamp').limitToLast(1).on('value', snap => {
            const p = document.getElementById('ultimo-treino');
            if (!p) return;
            if (!snap.exists()) {
                p.textContent = 'Nenhum treino registrado ainda.';
                return;
            }
     
snap.forEach(child => {
                const t = child.val();
                p.textContent = `√öltimo treino: ${t.dia} ‚Äî ${t.data} √†s ${t.hora}`;
            });
        });
} catch (err) { console.warn('carregarUltimoTreino erro', err); }
}

function contarTreinosDoMes() {
    try {
        const mesAtual = new Date().getMonth() + 1;
let total = 0;
        database.ref(getPath('treinosFinalizados')).once('value').then(snap => {
            snap.forEach(c => {
                const t = c.val();
                if (!t || !t.data) return;
                const parts = t.data.split('/');
                const mesT = parseInt(parts[1], 10);
  
if (mesT === mesAtual) total++;
            });
            const el = document.getElementById('contador-treinos');
            if (el) el.textContent = `Treinos no m√™s: ${total}`;
        }).catch(err => console.warn('contarTreinosDoMes erro', err));
} catch (err) { console.warn('contarTreinosDoMes erro', err); }
}

function carregarTreinosFinalizados() {
    try {
        const ref = database.ref(getPath('treinosFinalizados'));
ref.orderByChild('timestamp').once('value').then(snap => {
            const lista = [];
            snap.forEach(c => lista.push(c.val()));
            // atualizar lista textual
            const divList = document.getElementById('lista-historico-treinos');
            if (divList) {
                if (!lista.length) divList.innerHTML = '<p style="text-align:center;color:#999">Nenhum treino registrado.</p>';
  
else {
                    let html = '<ul style="padding-left:16px;">';
                    lista.slice().reverse().forEach(t => {
                        html += `<li style="margin:6px 0;">${t.data} ‚Äî ${t.dia} ‚Äî ${t.concluidoCount || 0} exerc√≠cios</li>`;
    
});
                    html += '</ul>';
                    divList.innerHTML = html;
                }
            }

            
// agrupamento por data para gr√°fico
            const agrupado = {};
            lista.forEach(t => {
                const key = t.data ||
'Sem data';
                agrupado[key] = (agrupado[key] || 0) + 1;
            });
            renderTreinosBarChart(agrupado);
        }).catch(err => console.warn('carregarTreinosFinalizados erro', err));
} catch (err) { console.warn('carregarTreinosFinalizados erro', err); }
}

let chartTreinos = null;
function renderTreinosBarChart(dataObj) {
    try {
        const canvas = document.getElementById('graficoTreinos');
if (!canvas) return;
        const labels = Object.keys(dataObj || {});
        const data = labels.map(l => dataObj[l] || 0);
if (typeof Chart === 'undefined') { console.warn('Chart.js n√£o carregado'); return;
}
        const ctx = canvas.getContext('2d');
        if (chartTreinos) chartTreinos.destroy();
chartTreinos = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Treinos (por data)',
             
data: data,
                    backgroundColor: 'rgba(255,193,7,0.9)',
                    borderColor: 'rgba(255,193,7,1)',
                    borderWidth: 1
                }]
            },
 
options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { ticks: { color: '#f0f0f0' } },
          
y: { beginAtZero: true, ticks: { color: '#f0f0f0' } }
                },
                plugins: { legend: { labels: { color: '#f0f0f0' } } }
            }
        });
} catch(err) { console.warn('renderTreinosBarChart erro', err); }
}

// marcar treino no calendario
function marcarTreinoNoCalendario(dataObj) {
    try {
        const dia = String(dataObj.getDate()).padStart(2,'0');
const mes = String(dataObj.getMonth()+1).padStart(2,'0');
        const ano = dataObj.getFullYear();
        const chave = `${dia}-${mes}-${ano}`;
        database.ref(getPath(`calendario/${chave}`)).set({ treinou: true, timestamp: Date.now() }).catch(e=>console.warn('marcarTreinoNoCalendario erro', e));
} catch(e){ console.warn('marcarTreinoNoCalendario erro', e); }
}

</script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>

    <style>
        /* --- ESTILOS GERAIS --- */
        body {
            font-family: 'Arial', sans-serif;
margin: 0;
            padding: 20px;
            background-color: #000000;
            color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
}

        nav {
            width: 100%;
max-width: 1200px;
            text-align: right;
            margin-bottom: 10px;
        }

        nav a {
            color: #ff8c00;
text-decoration: none;
            font-size: 0.9em;
        }

        /* HEADER */
        .header-content {
            display: flex;
align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
            gap: 20px;
            text-align: center;
            max-width: 100%;
}

        .header-content img {
            max-width: 80px;
height: auto;
            border-radius: 10px;
        }

        .header-content h1 {
            color: #ff8c00;
margin: 0;
            font-size: 2.2em;
            line-height: 1.2;
        }

        /* LAYOUT RESPONSIVO (GRID) */
        .container {
            max-width: 1200px;
margin: 0 auto;
            display: grid;
            gap: 20px;
            width: 100%;
            justify-content: center;
            grid-template-columns: 1fr;
}

        @media (min-width: 768px) {
            .container {
                grid-template-columns: 1fr 1fr;
}
            #chart-card {
                grid-column: 1 / 3;
order: 1;
            }
        }

        @media (min-width: 1024px) {
            .container {
                grid-template-columns: 1fr 1fr 1fr;
}
            #chart-card {
                grid-column: auto;
order: initial;
            }
        }

        /* CARDS */
        .card {
            background-color: rgba(255, 255, 255, 0.1);
padding: 25px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
}

        #medidas-card {
            order: 2;
}

        /* FORMUL√ÅRIOS E INPUTS */
        .input-group {
            display: flex;
gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            justify-content: space-between;
        }

        .input-group label {
            width: 95px;
flex-shrink: 0;
            font-size: 0.9em;
            color: #ccc;
        }

        #medidas-card .input-container {
            max-width: 350px;
margin: 0 auto 15px auto;
        }

        #medidas-card .input-group {
            width: 100%;
}

        .input-group input,
        select {
            flex-grow: 1;
padding: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #f0f0f0;
            border-radius: 4px;
            width: 100%;
box-sizing: border-box;
        }

        select {
            margin-bottom: 15px;
appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23ff9933" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
background-position: right 8px center;
            padding-right: 30px;
        }

        select option {
            background-color: #1a1a1a;
}

        h2 {
            color: #ff9933;
margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
        }

        .chart-container {
            position: relative;
height: 300px;
            width: 100%;
            margin-bottom: 20px;
        }

        /* LISTA DE TREINO */
        .exercicio-item {
            display: flex;
justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: background-color 0.3s;
}

        .exercicio-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
}

        .exercicio-info strong {
            font-size: 1.1em;
display: block;
            margin-bottom: 5px;
        }

        .checkbox-container input[type="checkbox"] {
            transform: scale(1.3);
cursor: pointer;
        }

        .concluido {
            background-color: #387038;
opacity: 0.7;
            text-decoration: line-through;
            color: #a0a0a0;
        }

        /* TABELA PRESEN√áA */
        .presenca-table {
            width: 100%;
border-collapse: collapse;
            text-align: center;
        }

        .presenca-table th,
        .presenca-table td {
            border: 1px solid rgba(255, 255, 255, 0.2);
padding: 8px;
            cursor: pointer;
        }

        .presenca-table th {
            background-color: #ff8c00;
color: white;
        }

        .presente {
            background-color: #5cb85c !important;
color: white;
        }

        /* BOT√ïES */
        button {
            padding: 10px 15px;
border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            transition: 0.3s;
}

        .btn-primary {
            background-color: #ffc107;
color: #333;
        }

        .btn-primary:hover {
            background-color: #e0a800;
}

        .reset-btn {
            margin-top: 15px;
background-color: #dc3545;
            color: white;
        }

        .reset-btn:hover {
            background-color: #c9302c;
}

        /* MODAL */
        .modal-overlay {
            position: fixed;
top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
zIndex: 1000;
        }

        .modal-content {
            background-color: #0d0d0d;
padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 2px solid #ff8c00;
}

        .modal-content img {
            max-width: 100px;
margin-bottom: 20px;
        }

        #botaoSalvarNome {
            background-color: #ff8c00;
color: #000;
            margin-top: 10px;
        }

        /* --- CAMPO DE PESQUISA IA --- */
        #ai-search-card {
            order: 3;
background-color: #1a1a1a;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #ai-search-card textarea {
            width: 100%;
min-height: 100px;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background-color: #000000;
            color: #f0f0f0;
resize: vertical;
box-sizing: border-box;
        }

        #ai-resposta {
            margin-top: 15px;
padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: transparent;
            border-radius: 8px;
            min-height: 50px;
            font-size: 0.9em;
            color: #ccc;
white-space: pre-wrap;
        }

        #ai-resposta strong {
            color: #ff9933;
}
    </style>
</head>

<body onload="obterNomeAluno()">

    <nav>
        <a href="professor.html">Acessar a P√°gina do Professor</a>
    </nav>

    <div id="modal-nome" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <img src="logotipo.png" alt="Logo PTF3" onerror="this.style.display='none'">
            <h3>Bem-vindo(a)!</h3>
            <p>Por favor, insira seu nome:</p>
            <input 
type="text" id="nomeModalInput" placeholder="Ex: Maria da Silva"
    style="
        width: 100%;
        padding: 12px;
        margin-bottom: 12px;
        background-color: rgba(255,255,255,0.08);
        color: #f0f0f0;
        text-align: center;
        border: 1px solid rgba(255,255,255,0.3);
        border-radius: 6px;
        display: block;
        
box-sizing: border-box; /* üî• FAZ FICAR EXATAMENTE IGUAL AO BOT√ÉO */
    ">

            <button id="botaoSalvarNome" onclick="salvarNomeModal()">Entrar</button>
        </div>
    </div>

    <div class="header-content">
        <img src="logotipo.png" alt="Logo PTF3" onerror="this.style.display='none'">
        <h1 id="main-title">Seja bem-vindo ao seu Espa√ßo.</h1>
    </div>

    <div class="container">

        <div id="chart-card" class="card">
           
<h2> Progress√£o de Carga</h2>
            <label for="seletorExercicio">Visualizar Exerc√≠cio:</label>
            <select id="seletorExercicio" onchange="inicializarGrafico()">
                <option value="AgachamentoLivre">Agachamento Livre</option>
                <option value="SupinoReto">Supino Reto</option>
                <option value="PuxadaFrontal">Puxada Frontal</option>
              
<option value="RoscaDireta">Rosca Direta</option>
                <option value="TricepsTesta">Tr√≠ceps Testa</option>
                <option value="DesenvolvimentoMilitar">Desenvolvimento Militar</option>
                <option value="CadeiraExtensora">Cadeira Extensora</option>
                <option value="ElevacaoPelvica">Eleva√ß√£o P√©lvica</option>
            </select>

            
<div class="chart-container">
                <canvas id="pesoChart"></canvas>
            </div>

            <div class="input-group">
                <input type="number" id="pesoInput" placeholder="Carga (kg)" step="0.5">
                <button class="btn-primary" onclick="adicionarPeso()">Registrar Carga</button>
            </div>
     
<button class="reset-btn" onclick="resetarDados('cargas')">Resetar Hist√≥rico</button>
        </div>

        <div id="medidas-card" class="card">
            <h2> Registro de Medidas</h2>
            <p style="margin-bottom: 15px;
font-size: 0.9em; color: #ccc; text-align: center;">Acompanhe sua evolu√ß√£o.
            </p>

            <div class="input-container">
                <div class="input-group"><label>Peso (kg)</label><input type="number" id="pesoCorporalInput"
                        placeholder="Ex: 75.5" step="0.1"></div>
                <div class="input-group"><label>Cintura</label><input type="number" id="cinturaInput" placeholder="cm"
  
                       step="1"></div>
                <div class="input-group"><label>Bra√ßo D.</label><input type="number" id="bracoInput" placeholder="cm"
                        step="0.5"></div>
                <div class="input-group"><label>T√≥rax</label><input type="number" id="toraxInput" placeholder="cm"
             
            step="1">
                </div>
                <div class="input-group"><label>Abd√¥men</label><input type="number" id="abdomenInput" placeholder="cm"
                        step="1"></div>
                <div class="input-group"><label>Coxa D.</label><input type="number" id="coxaInput" placeholder="cm"
        
                 step="0.5"></div>
                <div class="input-group"><label>Panturrilha</label><input type="number" id="panturrilhaInput"
                        placeholder="cm" step="0.5"></div>
                <div class="input-group"><label>Antebra√ßo</label><input type="number" id="antebracoInput"
                     
    placeholder="cm" step="0.5"></div>
            </div>

            <button class="btn-primary" onclick="registrarMedidas()">Registrar Medidas</button>

            <h3 style="margin-top: 15px;
color: #ff9933; text-align: center;">√öltimos Registros</h3>
            <div id="ultimasMedidas" style="font-size: 0.9em;
color: #ccc; text-align: center;">Nenhum registro
                encontrado.</div>
            <button class="reset-btn" onclick="resetarDados('medidas')">Resetar Medidas</button>
        </div>

        <div id="treino-card" class="card">
            <h2> Treino de For√ßa</h2>

            <label for="seletorTreino">Selecionar Dia:</label>
            <select id="seletorTreino" onchange="alternarTreino()">
    
<option value="Dia A">Dia A </option>
                <option value="Dia B">Dia B </option>
                <option value="Dia C">Dia C </option>
            </select>
            <hr style="border-color: rgba(255, 255, 255, 0.2);">

            <p style="text-align: center;"><strong>Aluno:</strong> 
<span id="nome-aluno" style="color:#ff8c00">...</span>
                | <strong>Data:</strong>
                <span id="data-atual"></span></p>

            <div id="treino-Dia A" class="lista-treino-dia">
                <h3>Dia A: </h3>
                <ul id="lista-treino-a" style="list-style: none;
padding: 0;">
                    <li class="exercicio-item" style="background: none;
border: none; color: #ff9933;">Carregando treino...
                    </li>
                </ul>
            <div style="margin-top:10px;"><button class="btn-primary btn-finalizar-treino" onclick="finalizarTreino()">Finalizar Treino</button></div>
            </div>

            <div id="treino-Dia B" class="lista-treino-dia" style="display: none;">
              
<h3>Dia B: </h3>
                <ul id="lista-treino-b" style="list-style: none;
padding: 0;">
                    <li class="exercicio-item" style="background: none;
border: none; color: #ff9933;">Carregando treino...
                    </li>
                </ul>
            <div style="margin-top:10px;"><button class="btn-primary btn-finalizar-treino" onclick="finalizarTreino()">Finalizar Treino</button></div>
            </div>

            <div id="treino-Dia C" class="lista-treino-dia" style="display: none;">
              
<h3>Dia C: </h3>
                <ul id="lista-treino-c" style="list-style: none;
padding: 0;">
                    <li class="exercicio-item" style="background: none;
border: none; color: #ff9933;">Carregando treino...
                    </li>
                </ul>
            <div style="margin-top:10px;"><button class="btn-primary btn-finalizar-treino" onclick="finalizarTreino()">Finalizar Treino</button></div>
            </div>
        </div>

        <div id="ai-search-card" class="card">
            <h2> 
IA PTF3</h2>

            <label for="exercicioPergunta">O que voc√™ gostaria de saber sobre o exerc√≠cio?</label>
            <textarea id="exercicioPergunta" placeholder= "Ex:'Qual a forma correta de fazer agachamento livre?'
Ou 'Quais os m√∫sculos ativados no supino?'" ></textarea>

            <button class="btn-primary" onclick="simularPesquisaIA()">Perguntar √† IA</button>

            <h3 style="margin-top: 15px;
color: #ff9933; text-align: center;">Resposta da IA</h3>
            <div id="ai-resposta">
                
            </div>
        </div>
        <div id="presenca-card" class="card">
            <h2> Presen√ßa Mensal</h2>

            <p style="text-align: center;">Clique nas datas para marcar.</p>
    
<table class="presenca-table">
                <thead>
                    <tr>
                        <th>Dom</th>
                        <th>Seg</th>
       
<th>Ter</th>
                        <th>Qua</th>
                        <th>Qui</th>
                        <th>Sex</th>
           
<th>S√°b</th>
                    </tr>
                </thead>
                <tbody id="calendario-body"></tbody>
            </table>
    <div id="status-treino" class="card" style="margin-top:15px;
text-align:center;">
        <p id="ultimo-treino" style="color:#ff9933;">Carregando √∫ltimo treino...</p>
        <p id="contador-treinos" style="color:#ffd700;
font-weight:bold;">Treinos no m√™s: 0</p>

        <div style="max-width:640px;
margin:10px auto;">
            <canvas id="graficoTreinos" height="200"></canvas>
        </div>

        <div id="lista-historico-treinos" style="max-width:640px;
margin:8px auto; color:#ddd; text-align:left;"></div>
    </div>
    
            <button class="reset-btn" onclick="resetarDados('presenca')">Resetar Presen√ßas</button>
        </div>

    </div>

    <script>
        // CONFIGURA√á√ÉO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyQDLkdyL4qgoEj1YqBr2xCs0F3aM1o82ef0",
            authDomain: "ptf03-26fdb.firebaseapp.com",
           
databaseURL: "https://ptf03-26fdb-default-rtdb.firebaseio.com",
            projectId: "ptf03-26fdb",
            storageBucket: "ptf03-26fdb.firebaseapp.com",
            messagingSenderId: "1020981883676",
            appId: "1:1020981883676:web:7b26aca25ddb1dc02100d9"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let alunoNome = '';
     
let pesoChart;

        function getPath(sub) {
            return `alunos/${alunoNome.replace(/\s/g, '_')}/${sub}`;
        }

        // --- BANCO DE DADOS LOCAL (ATUALIZADO E COMPLETO) ---
        const normalize = (str) => str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
        // Dados brutos fornecidos (Muscula√ß√£o, Powerlifting, CrossFit, Pilates, Cardio, Nutri√ß√£o, Sa√∫de)
        const rawData = [
            // ================== 1. MUSCULA√á√ÉO (BODYBUILDING) - Peito ==================
            "Supino Reto | Muscula√ß√£o | Peito | Peitoral Maior, Delt√≥ide Anterior, Tr√≠ceps | Deite no banco, p√©s firmes no ch√£o. Des√ßa a barra at√© tocar (ou quase tocar) o meio do peito e empurre. | Concentre-se em 'quebrar a barra' com as m√£os para engajar os ombros e estabilizar.",
            "Supino Inclinado | Muscula√ß√£o | Peito | Peitoral Maior (Foco na parte superior), Delt√≥ide Anterior, Tr√≠ceps | Semelhante ao reto, mas em um banco inclinado (30-45 graus). | Excelente para isolar a por√ß√£o clavicular (superior) do peito. N√£o incline demais para evitar recrutar apenas os ombros.",
            "Crossover (Cabo) | Muscula√ß√£o | Peito | Peitoral Maior (Foco na parte interna) | Fique no centro da m√°quina, cabos em n√≠vel alto. Leve as m√£os em arco para baixo e para frente, cruzando-as na frente do corpo. | Foque na contra√ß√£o m√°xima do peito ao 'espremer' as m√£os na frente. Mantenha os cotovelos levemente flexionados.",
            "Flex√£o de Bra√ßo (Push-up) | Muscula√ß√£o | Peito/Core | Peitoral, Delt√≥ide Anterior, Tr√≠ceps, Core | Deite de bru√ßos, apoie as m√£os na largura dos ombros. Mantenha o corpo reto e des√ßa o peito pr√≥ximo ao ch√£o. | Mantenha o core (abd√¥men) contra√≠do e as esc√°pulas est√°veis para proteger a lombar.",
            
            // ================== 1. MUSCULA√á√ÉO (BODYBUILDING) - Costas ==================
            "Puxada Alta (Lat Pulldown) | Muscula√ß√£o | Costas | Lat√≠ssimo do Dorso (Grande Dorsal), B√≠ceps, Romboides | Sentado na m√°quina, joelhos travados. Puxe a barra em dire√ß√£o ao peito, inclinando levemente o tronco para tr√°s. | Concentre-se em conectar o movimento com a retra√ß√£o das esc√°pulas. Evite o impulso do tronco. Concentre-se em 'puxar com os cotovelos' para isolar as costas.",
            "Remada Curvada com Barra | Muscula√ß√£o | Costas | Lat√≠ssimo do Dorso, Romboides, Trap√©zio | Incline o tronco para frente (45-70 graus), mantendo a coluna reta (neutra). Puxe a barra em dire√ß√£o ao abd√¥men inferior. | O tronco deve permanecer fixo. N√£o use as pernas para levantar o peso. Mantenha a barra pr√≥xima ao corpo.",
            "Remada Sentada (Cabo) | Muscula√ß√£o | Costas | Lat√≠ssimo do Dorso, Romboides, Trap√©zio M√©dio | Sente-se na m√°quina com o tronco reto. Puxe o cabo em dire√ß√£o ao abd√¥men, retraindo as esc√°pulas. | Mantenha a coluna reta. Concentre-se em levar os cotovelos para tr√°s, sentindo a contra√ß√£o das costas.",
            "Pullover | Muscula√ß√£o | Costas/Peito | Lat√≠ssimo do Dorso, Peitoral Maior, Tr√≠ceps | Deitado no banco (transversalmente para maior amplitude), segure um halter acima da cabe√ßa. Des√ßa o peso em arco para tr√°s e retorne. | Excelente para alongamento do lat√≠ssimo e na expans√£o da caixa tor√°cica.",
            "Hiperextens√£o Lombar | Muscula√ß√£o | Costas | Eratores da Espinha, Gl√∫teos, Isquiotibiais | Na m√°quina, prenda os p√©s e incline o tronco para baixo. Use a for√ßa da lombar e gl√∫teos para levantar o tronco at√© a linha reta. | Mantenha o movimento controlado e evite a hiperextens√£o na parte superior. Foco na for√ßa da parte inferior das costas.",

            // ================== 1. MUSCULA√á√ÉO (BODYBUILDING) - Ombros ==================
            "Desenvolvimento Militar | Muscula√ß√£o | Ombros | Delt√≥ide Anterior e Medial, Tr√≠ceps | Em p√© (ou sentado com apoio), comece com a barra/halteres na altura dos ombros. Empurre o peso verticalmente para cima at√© a extens√£o completa. | Mantenha o core (abd√¥men) contra√≠do e evite arquear a lombar (hiperextens√£o) durante o empurr√£o.",
            "Eleva√ß√£o Lateral | Muscula√ß√£o | Ombros | Delt√≥ide Medial (Lateral) | Em p√©, segure halteres ao lado do corpo. Levante os bra√ßos lateralmente em arco at√© a altura dos ombros. Mantenha os cotovelos levemente flexionados. | N√£o use o impulso do corpo. O movimento deve ser suave e o peso controlado. Pare na altura do ombro.",
            "Eleva√ß√£o Frontal | Muscula√ß√£o | Ombros | Delt√≥ide Anterior | Em p√©, levante os halteres √† sua frente at√© a altura dos ombros. | Mantenha o controle do movimento. N√£o use pesos muito pesados para evitar o recrutamento do trap√©zio.",
            "Face Pull (Cabo) | Muscula√ß√£o | Ombros/Costas | Delt√≥ide Posterior, Romboides, Trap√©zio | Puxe a corda do cabo alto em dire√ß√£o ao rosto, abrindo as m√£os no final do movimento. | Excelente para sa√∫de e estabilidade do ombro, focando na parte posterior (que geralmente √© negligenciada).",
            "Crucifixo Invertido (M√°quina/Halteres) | Muscula√ß√£o | Ombros/Costas | Delt√≥ide Posterior | Incline-se para frente ou use a m√°quina. Abra os bra√ßos para fora. | O movimento √© o inverso da eleva√ß√£o lateral. Foco na contra√ß√£o da parte de tr√°s do ombro, n√£o no trap√©zio.",

            // ================== 1. MUSCULA√á√ÉO (BODYBUILDING) - Bra√ßos ==================
            "Rosca Direta com Barra | Muscula√ß√£o | B√≠ceps | B√≠ceps Braquial, Braquial | Em p√©, segure a barra com pegada supinada (palmas para cima). Mantenha os cotovelos fixos e pr√≥ximos ao corpo. Flexione-os, levantando a barra em dire√ß√£o ao peito. | Os cotovelos devem permanecer fixos e ao lado do corpo. Evite balan√ßar o tronco (roubar) para preservar a tens√£o no b√≠ceps.",
            "Rosca Alternada | Muscula√ß√£o | B√≠ceps/Antebra√ßo | B√≠ceps Braquial, Braquial | Em p√©, alterne a flex√£o dos cotovelos, usando uma pegada supinada. | Concentre-se em girar o pulso (supina√ß√£o) no topo do movimento para maximizar a contra√ß√£o do b√≠ceps.",
            "Rosca Martelo | Muscula√ß√£o | B√≠ceps/Antebra√ßo | Braquial, Braquiorradial (Antebra√ßo), B√≠ceps | Em p√©, segure halteres com as palmas voltadas uma para a outra (pegada neutra). Flexione os cotovelos. | Foco no desenvolvimento do pico do b√≠ceps e do antebra√ßo.",
            "Tr√≠ceps Testa | Muscula√ß√£o | Tr√≠ceps | Tr√≠ceps Braquial (Foco na cabe√ßa longa) | Deitado no banco, estenda os bra√ßos com barra/halteres. Flexione os cotovelos, baixando o peso em dire√ß√£o √† testa. Estenda. | Mantenha os cotovelos fixos e apontando para o teto. N√£o permita que eles se abram para os lados.",
            "Tr√≠ceps Pulley (Corda) | Muscula√ß√£o | Tr√≠ceps | Tr√≠ceps Braquial (Foco na cabe√ßa lateral) | Segure a corda no cabo alto. Empurre a corda para baixo, abrindo as m√£os no final do movimento. | Mantenha os cotovelos fixos ao lado do corpo e o tronco levemente inclinado para frente.",
            "Tr√≠ceps Coice | Muscula√ß√£o | Tr√≠ceps | Tr√≠ceps Braquial (Isolamento) | Incline o tronco para frente (45¬∞), cotovelo fixo. Estenda o bra√ßo para tr√°s, contraindo o tr√≠ceps. | Mantenha o cotovelo fixo e n√£o balance o bra√ßo. Foco na extens√£o completa no topo do movimento.",
            "Paralelas (Dips) | Muscula√ß√£o | Tr√≠ceps/Peito | Tr√≠ceps Braquial, Peitoral Inferior, Delt√≥ide Anterior | Segure nas barras paralelas. Des√ßa o corpo flexionando os cotovelos e empurre de volta. | Para focar no tr√≠ceps, mantenha o tronco mais vertical. Para focar no peito, incline-se para frente.",
            "Tr√≠ceps Franc√™s | Muscula√ß√£o | Tr√≠ceps | Tr√≠ceps Braquial (Foco na cabe√ßa longa) | Sentado ou em p√©, segure um peso acima da cabe√ßa. Flexione os cotovelos, baixando o peso atr√°s da cabe√ßa e estenda. | Mantenha os cotovelos pr√≥ximos √† cabe√ßa para isolar a cabe√ßa longa.",

            // ================== 1. MUSCULA√á√ÉO (BODYBUILDING) - Pernas/Gl√∫teos ==================
            "Agachamento Livre | Muscula√ß√£o | Pernas/Gl√∫teos | Quadr√≠ceps, Gl√∫teo M√°ximo, Isquiotibiais | Barra nas costas (trap√©zio superior). Des√ßa o quadril abaixo da linha do joelho. Mantenha o tronco reto. | Use cal√ßados de sola reta ou eleve o calcanhar (para quem tem pouca mobilidade). O joelho deve acompanhar a dire√ß√£o da ponta do p√©.",
            "Leg Press 45¬∞ | Muscula√ß√£o | Pernas/Gl√∫teos | Quadr√≠ceps (principalmente), Gl√∫teo M√°ximo, Isquiotibiais | Sente-se na m√°quina. Empurre a plataforma com os p√©s. | N√£o trave os joelhos no topo. N√£o des√ßa com o quadril saindo do banco.",
            "Eleva√ß√£o P√©lvica (Hip Thrust) | Muscula√ß√£o | Gl√∫teos | Gl√∫teo M√°ximo (Foco principal), Isquiotibiais | Apoie as costas no banco. Barra na linha do quadril. Levante o quadril em dire√ß√£o ao teto, contraindo o gl√∫teo no topo. | Mantenha o queixo 'preso' (olhando para a frente) para evitar arquear a lombar. Foco na contra√ß√£o m√°xima do gl√∫teo no topo.",
            "Mesa Flexora | Muscula√ß√£o | Posterior de Coxa | Isquiotibiais (B√≠ceps Femoral, Semitend√≠neo, Semimembranoso) | Deitado ou sentado na m√°quina, flexione os joelhos, puxando a almofada em dire√ß√£o ao gl√∫teo. | Foco na fase negativa (retorno) para maximizar o dano muscular.",
            "Cadeira Extensora | Muscula√ß√£o | Quadr√≠ceps | Quadr√≠ceps (Isolamento) | Sentado na m√°quina, estenda as pernas contra a almofada at√© a total contra√ß√£o do m√∫sculo. Volte controladamente, resistindo ao peso. | Conscientemente, contraia o quadr√≠ceps no topo do movimento antes de retornar, garantindo o m√°ximo recrutamento.",
            "Agachamento Hack | Muscula√ß√£o | Pernas/Quadr√≠ceps | Quadr√≠ceps (Isolamento) | Use a m√°quina Hack. Apoie as costas e os ombros. Des√ßa flexionando os joelhos. | A m√°quina auxilia na estabiliza√ß√£o. A profundidade √© limitada pela flexibilidade do quadril.",
            "Passada (Lunge) | Muscula√ß√£o | Pernas/Gl√∫teos | Quadr√≠ceps, Gl√∫teo M√°ximo, Isquiotibiais | D√™ um passo grande para frente e abaixe o quadril at√© que o joelho de tr√°s quase toque o ch√£o. Empurre para retornar. | Mantenha o tronco reto. O joelho da frente n√£o deve ultrapassar a ponta do p√© excessivamente.",
            "Agachamento B√∫lgaro | Muscula√ß√£o | Pernas/Gl√∫teos | Quadr√≠ceps, Gl√∫teo M√°ximo | Apoie um p√© em um banco atr√°s de voc√™. Agache com a perna da frente, mantendo o tronco ereto. | √â um exerc√≠cio unilateral que exige equil√≠brio. Foco em descer verticalmente.",
            "Stiff (com Barra/Halteres) | Muscula√ß√£o | Posterior de Coxa/Gl√∫teos | Isquiotibiais, Gl√∫teo M√°ximo, Eretores da Espinha | Em p√©, joelhos levemente flexionados (n√£o travados). Des√ßa a barra rente √†s pernas, inclinando o tronco. | O movimento √© no quadril. Mantenha a coluna reta (neutra). Foco no alongamento dos isquiotibiais.",
            "Cadeira Adutora | Muscula√ß√£o | Adutores | Adutores da Coxa | Sente-se na m√°quina. Junte as pernas contra a resist√™ncia. | Importante para a for√ßa e estabilidade do quadril e preven√ß√£o de les√µes na virilha.",
            "Glute Ham Raise (GHR) | Muscula√ß√£o | Posterior/Gl√∫teos | Isquiotibiais, Gl√∫teos, Lombar | Use a m√°quina GHR. Prenda os p√©s e o joelho. Des√ßa o tronco esticado para o ch√£o e volte usando a for√ßa dos isquiotibiais e gl√∫teos. | √â um exerc√≠cio avan√ßado que trabalha a cadeia posterior de forma completa.",
            "Abdu√ß√£o de Quadril (M√°quina) | Muscula√ß√£o | Gl√∫teos | Gl√∫teo M√©dio e M√≠nimo | Sente-se na m√°quina. Empurre as pernas para fora, contra a resist√™ncia. | Foco nos m√∫sculos estabilizadores do quadril. Importante para a sa√∫de do joelho e alinhamento p√©lvico.",
            "Eleva√ß√£o de Panturrilha em P√© | Muscula√ß√£o | Panturrilha | Gastrocn√™mio (M√∫sculo externo e interno) | Em p√©, suba nos dedos do p√©, elevando os calcanhares o m√°ximo poss√≠vel. | Use uma plataforma para permitir maior amplitude de movimento (alongamento na parte inferior).",
            "Eleva√ß√£o de Panturrilha Sentado | Muscula√ß√£o | Panturrilha | S√≥leo (M√∫sculo profundo) | Sentado na m√°quina, suba nos dedos dos p√©s contra a resist√™ncia. | Ao sentar, o joelho est√° dobrado, o que isola o m√∫sculo s√≥leo. Importante para o volume total da panturrilha.",

            // ================== 1. MUSCULA√á√ÉO (BODYBUILDING) - Abd√¥men/Core ==================
            "Abdominal Crunch | Muscula√ß√£o | Core/Abd√¥men | Reto Abdominal | Deitado de costas, flexione o tronco, levantando os ombros e a cabe√ßa. | Concentre-se em 'enrolar' a coluna. Evite puxar com os bra√ßos ou usar impulso.",
            "Russian Twist | Muscula√ß√£o | Core/Abd√¥men | Obl√≠quos Internos e Externos | Sentado no ch√£o, tronco inclinado para tr√°s, p√©s no ar (ou no ch√£o). Gire o tronco de um lado para o outro. | Mantenha o core engajado. O movimento deve vir da rota√ß√£o do tronco, n√£o apenas dos bra√ßos.",

            // ================== 2. POWERLIFTING ==================
            "Agachamento Low Bar (Barra Baixa) | Powerlifting | Agachamento | Gl√∫teo M√°ximo, Isquiotibiais, Quadr√≠ceps | A barra √© posicionada mais baixa nas costas (na parte posterior do delt√≥ide). Des√ßa priorizando a inclina√ß√£o do tronco e o impulso do quadril. | Exige maior mobilidade de ombro e tornozelo. A t√©cnica √© voltada para maximizar a carga, mantendo o padr√£o de movimento competitivo.",
            "Agachamento High Bar | Powerlifting | Agachamento | Quadr√≠ceps, Gl√∫teo M√°ximo | A barra √© posicionada mais alta, sobre o trap√©zio superior. O tronco permanece mais vertical. | Mais amig√°vel para iniciantes e foca mais no quadr√≠ceps. Menor inclina√ß√£o do tronco. Mais comum em LPO.",
            "Supino com Pausa | Powerlifting | Supino | Peitoral, Tr√≠ceps, Delt√≥ide Anterior | O movimento √© igual ao supino reto, mas exige uma pausa de 1 segundo *logo acima* do peito, sem tocar. Empurre de volta. | Fortalece o controle e a tens√£o na parte inferior do movimento, crucial para estabilidade.",
            "Floor Press (Supino no ch√£o) | Powerlifting | Supino | Tr√≠ceps Braquial, Peitoral | Deite no ch√£o. A amplitude √© limitada pelo contato dos cotovelos com o ch√£o. | Excelente isolamento do tr√≠ceps e reduz o estresse do ombro. √ötil para superar o ponto de 'lockout'.",
            "Levantamento Terra Convencional | Powerlifting | Terra | Cadeia Posterior (Lombar, Gl√∫teos, Isquiotibiais), Trap√©zio | Fique com os p√©s na largura do quadril. Segure a barra fora dos joelhos. Puxe o peso do ch√£o, esticando o quadril e os joelhos simultaneamente. | A coluna deve ser neutra (reta) durante todo o movimento. Mantenha o peso o mais pr√≥ximo poss√≠vel do corpo.",
            "Levantamento Terra Sum√¥ | Powerlifting | Terra | Gl√∫teo M√°ximo, Quadr√≠ceps (mais √™nfase) | Pegada dentro das pernas e p√©s bem abertos. O tronco fica mais vertical que no convencional. | Exige menos mobilidade de quadril para profundidade, mas requer forte abdu√ß√£o do quadril. Tende a ser menos estressante para a lombar.",

            // ================== 3. CROSSFIT (LPO - Levantamento de Peso Ol√≠mpico) ==================
            "Snatch (Arranco) | CrossFit | LPO | Corpo Inteiro, Principalmente Quadr√≠ceps, Trap√©zio | O peso √© levantado do ch√£o em um movimento explosivo e √∫nico at√© acima da cabe√ßa. O atleta recebe a barra na posi√ß√£o de Agachamento Overhead (OHS). | √â o movimento mais t√©cnico. Exige velocidade, flexibilidade e for√ßa. O foco √© a acelera√ß√£o explosiva.",
            "Clean and Jerk (Arremesso) | CrossFit | LPO | Corpo Inteiro, Principalmente Quadr√≠ceps, Ombros, Tr√≠ceps | Movimento em duas partes: 1. Clean (o peso vai do ch√£o para os ombros) e 2. Jerk (o peso vai dos ombros para cima da cabe√ßa). | O Jerk usa a for√ßa das pernas (em split ou push) para levar a barra dos ombros para cima da cabe√ßa. √â crucial receber a barra na posi√ß√£o correta (rack frontal) e usar as pernas para a segunda parte (Jerk).",
            "Overhead Squat (OHS) | CrossFit | LPO | Corpo Inteiro, Estabilidade de Ombro/Core | Agache com a barra totalmente estendida acima da cabe√ßa (posi√ß√£o final do Snatch). | Requer excelente mobilidade de ombros, coluna tor√°cica e tornozelos. √â um teste de estabilidade de corpo inteiro.",
            "Hang Power Clean | CrossFit | LPO | Quadr√≠ceps, Trap√©zio, Ombros | O levantamento come√ßa com a barra na altura dos quadris/joelhos (hang) e termina no 'rack' dos ombros sem agachar completamente (power). | Foco na acelera√ß√£o explosiva e na velocidade da transi√ß√£o.",
            "Thruster | CrossFit | LPO/Gin√°stica | Quadr√≠ceps, Delt√≥ides, Tr√≠ceps | Agachamento Frontal seguido imediatamente por um Desenvolvimento Militar (Press) em um movimento fluido e sem pausas. | Use a for√ßa de impuls√£o das pernas ao sair do agachamento para transferir a energia para o empurr√£o do peso acima da cabe√ßa.",
            
            // ================== 3. CROSSFIT (GIN√ÅSTICA) ==================
            "Pull-up (Kipado) | CrossFit | Gin√°stica | Costas, B√≠ceps, Core | Pendure-se na barra. Use um balan√ßo de quadril e core (Kip) para gerar impulso e levar o queixo acima da barra. | √â uma t√©cnica que visa a efici√™ncia e o volume (repeti√ß√µes). O balan√ßo deve ser controlado.",
            "Muscle Up (Barra) | CrossFit | Gin√°stica | Costas, B√≠ceps, Tr√≠ceps, Peito, Core | Movimento que leva o corpo debaixo da barra para cima da barra (transi√ß√£o), terminando em um *Dip*. | A transi√ß√£o √© o mais dif√≠cil. √â um movimento completo que exige for√ßa de puxada (back) e empurr√£o (tr√≠ceps/peito).",
            "Toes-to-Bar (T2B) | CrossFit | Gin√°stica | Core (Reto Abdominal e Flexores do Quadril) | Pendurado na barra, use o balan√ßo do corpo (kip) controlado para levantar os p√©s at√© que toquem a barra (entre as m√£os). | O movimento deve ser controlado pelo core; evite balan√ßar descontroladamente. Foque em manter a forma 'Hollow' e 'Arch'.",
            "Handstand Push-up (HSPU) | CrossFit | Gin√°stica | Delt√≥ides, Tr√≠ceps, Core (Invertido) | Em parada de m√£os (contra a parede), flexione os cotovelos at√© a cabe√ßa tocar o ch√£o e empurre de volta. | Mantenha o corpo e o core travados. A cabe√ßa deve tocar o ch√£o √† frente das m√£os para formar um trip√©.",
            "Ring Dips | CrossFit | Gin√°stica | Tr√≠ceps, Peitoral, Delt√≥ide Anterior | Mergulho nas argolas. Des√ßa at√© os ombros ficarem abaixo dos cotovelos e estenda. | Exige extrema estabilidade do ombro, pois as argolas s√£o m√≥veis. Mantenha os cotovelos pr√≥ximos ao corpo.",

            // ================== 3. CROSSFIT (CONDICIONAMENTO) ==================
            "Wall Ball | CrossFit | Condicionamento | Quadr√≠ceps, Gl√∫teos, Delt√≥ides | Segure uma bola medicinal no peito. Agache e use o impulso para arremessar a bola em um alvo na parede. | O agachamento deve ser profundo (abaixo do paralelo). √â um exerc√≠cio que combina for√ßa e resist√™ncia cardiorrespirat√≥ria.",
            "Kettlebell Swing (Americano) | CrossFit | Condicionamento | Gl√∫teos, Isquiotibiais, Core | Balance o Kettlebell entre as pernas e use o impulso do quadril para levant√°-lo acima da cabe√ßa. | A for√ßa vem da extens√£o explosiva do quadril. O padr√£o Americano exige que o peso v√° acima da cabe√ßa.",
            "Box Jump | CrossFit | Condicionamento | Quadr√≠ceps, Gl√∫teos | Salte sobre uma caixa alta, aterrissando com ambos os p√©s no topo. | Concentre-se no amortecimento suave da aterrissagem para proteger as articula√ß√µes.",
            "Double Under (Salto Duplo) | CrossFit | Condicionamento | Panturrilhas, Core, Condicionamento | Salto de corda onde a corda passa duas vezes por baixo dos p√©s a cada salto. | Exige um salto mais alto e um giro de pulso muito mais r√°pido. Mantenha o corpo reto e o core ativado.",

            // ================== 4. PILATES ==================
            "The Hundred (O Cem) | Pilates | Mat/Solo | Transverso do Abd√¥men (Core), Reto Abdominal | Deitado de costas, levante a cabe√ßa e os ombros. Pernas a 45 graus. Bombeie os bra√ßos ritmicamente (5 inspira√ß√µes/5 expira√ß√µes). | Mantenha a lombar pressionada contra o solo ativamente. A respira√ß√£o profunda e controlada √© o foco do exerc√≠cio.",
            "Roll Up | Pilates | Mat/Solo | Reto Abdominal, Flexibilidade da Coluna | Deitado de costas, suba o tronco v√©rtebra por v√©rtebra, alcan√ßando os p√©s, e des√ßa da mesma forma. | Use o abd√¥men, n√£o o impulso. O movimento deve ser lento e controlado, como se estivesse 'descascando' a coluna do ch√£o.",
            "Single Leg Circle | Pilates | Mat/Solo | Core, Estabilizadores do Quadril | Deitado de costas, pernas esticadas, gire uma perna em pequenos c√≠rculos, mantendo o tronco e a pelve fixos no ch√£o. | O desafio √© manter o core firme. Os c√≠rculos devem ser suaves e controlados.",
            "Single Leg Stretch | Pilates | Mat/Solo | Reto Abdominal, Flexores do Quadril | Deitado, traga um joelho ao peito e estique a outra perna. Troque as pernas rapidamente, mantendo o tronco elevado. | Mantenha a estabilidade do tronco e controle o movimento das pernas pelo core.",
            "Rolling Like a Ball | Pilates | Mat/Solo | Core, Massagem da Coluna | Sentado, abrace os joelhos e se curve em formato de bola. Balance para tr√°s e para frente sobre a coluna. | O movimento deve ser suave e fluido. Mantenha a forma de 'C' na coluna.",
            "Spine Stretch Forward | Pilates | Mat/Solo | Flexibilidade da Coluna, Isquiotibiais | Sentado com as pernas abertas, estique o tronco para frente, curvando a coluna. | Foco na flex√£o da coluna e no alongamento dos isquiotibiais.",
            "Single Straight Leg Stretch | Pilates | Mat/Solo | Core, Isquiotibiais, Pelve | Deitado, levante uma perna esticada em dire√ß√£o ao teto e puxe-a suavemente. A outra perna fica esticada pr√≥xima ao ch√£o. Troque as pernas. | Foco no alongamento dos isquiotibiais da perna levantada e na estabilidade do core.",
            "The Saw (O Serrote) | Pilates | Mat/Solo | Obl√≠quos, Extens√£o/Flex√£o da Coluna | Sentado com as pernas abertas, gire o tronco e incline-se para frente, alcan√ßando o dedo m√≠nimo com a m√£o oposta ('serrando' o ar). | A rota√ß√£o deve vir da cintura. Mantenha os √≠squios firmes no ch√£o e os p√©s flexionados.",
            "Teaser | Pilates | Mat/Solo | Reto Abdominal, Flexores do Quadril, Estabilizadores | Sentado, eleve o tronco e as pernas esticadas, formando um 'V' equilibrado. Estique os bra√ßos paralelamente √†s pernas. | A estabilidade do core √© o foco. Encontre o equil√≠brio nos √≠squios. Se for dif√≠cil, mantenha os joelhos dobrados (varia√ß√£o 'Table Top').",
            "Swimming (Nata√ß√£o) | Pilates | Mat/Solo | Paravertebrais (Extensores da Coluna), Gl√∫teos | Deitado de bru√ßos, levante a cabe√ßa, bra√ßos e pernas. Alterne bra√ßo e perna opostos (como nadando). | Foco na extens√£o da coluna e no fortalecimento dos m√∫sculos da parte de tr√°s do corpo (cadeia posterior).",

            // ================== 5. CARDIO / EXERC√çCIOS FUNCIONAIS ==================
            "Burpee | Aer√≥bico | Cardio/Corpo Inteiro | Corpo Inteiro | Comece em p√©, agache, coloque as m√£os no ch√£o, jogue os p√©s para tr√°s (posi√ß√£o de prancha), fa√ßa uma flex√£o (opcional), retorne os p√©s e salte com os bra√ßos para cima. | O movimento deve ser r√°pido e fluido. Mantenha a forma da prancha/flex√£o para proteger a lombar.",
            "Pular Corda | Aer√≥bico | Cardio | Panturrilhas, Condicionamento | Salte sobre a corda, mantendo os joelhos levemente flexionados. | Foco na cad√™ncia e no uso dos punhos para girar a corda.",
            "Corrida (Steady State) | Aer√≥bico | Cardio | Pernas, Condicionamento Card√≠aco | Corrida em ritmo constante e moderado por um per√≠odo prolongado. | Excelente para queima de gordura e resist√™ncia cardiorrespirat√≥ria.",
            "HIIT (Treinamento Intervalado de Alta Intensidade) | Aer√≥bico | Cardio | Corpo Inteiro | Altern√¢ncia de per√≠odos curtos e intensos de exerc√≠cio (30-60s) com per√≠odos de descanso ou baixa intensidade. | Mais eficiente para queima de calorias em menos tempo. A chave √© a intensidade m√°xima no per√≠odo de trabalho.",
            "El√≠ptico | Aer√≥bico | Cardio | Pernas, Corpo Superior, Condicionamento | Equipamento que simula uma corrida sem impacto. | Mantenha os calcanhares na plataforma e use os bra√ßos ativamente (puxando e empurrando) para recrutar a parte superior do corpo.",
            "Remo (Rowing) | Aer√≥bico | Cardio | Corpo Inteiro (Pernas, Costas, Core, Bra√ßos) | Sente-se na m√°quina. Empurre com as pernas, puxe a al√ßa para o tronco e estenda o corpo. | O movimento deve ser 60% pernas, 20% tronco e 20% bra√ßos. Mantenha a sequ√™ncia correta: Perna, Tronco, Bra√ßo; e Retorno: Bra√ßo, Tronco, Perna. Foque na fluidez e pot√™ncia do impulso da perna.",

            // ================== 6. ALONGAMENTOS ==================
            "Alongamento de Quadr√≠ceps (Em P√©) | Alongamento | Pernas | Quadr√≠ceps (Reto Femoral e Vasto) | Em p√© e segurando-se em um apoio, dobre o joelho e puxe o tornozelo em dire√ß√£o ao gl√∫teo. Mantenha os joelhos alinhados. | Mantenha o quadril neutro (n√£o empine) para garantir que o alongamento ocorra na parte da frente da coxa, e n√£o na lombar.",
            "Alongamento de Isquiotibiais (Sentado) | Alongamento | Pernas | Isquiotibiais | Sentado, pernas esticadas, incline o tronco para frente em dire√ß√£o aos p√©s, mantendo a coluna reta. | Foco em sentir o alongamento na parte de tr√°s da coxa e n√£o na lombar. Se necess√°rio, flexione levemente os joelhos.",
            "Alongamento de Peito (na Parede) | Alongamento | Peito | Peitoral Maior | Coloque o antebra√ßo na parede, com o cotovelo na altura do ombro. Gire o corpo para fora, sentindo o alongamento na parte frontal do ombro e peito. | Mantenha o ombro para baixo (longe da orelha).",
            "Alongamento de Tr√≠ceps (Acima da Cabe√ßa) | Alongamento | Bra√ßos | Tr√≠ceps Braquial | Leve um bra√ßo dobrado para tr√°s da cabe√ßa. Use a m√£o oposta para puxar suavemente o cotovelo para tr√°s. | Sinta o alongamento na parte de tr√°s do bra√ßo.",
            "Alongamento de Pesco√ßo (Lateral) | Alongamento | Pesco√ßo | Escalenos, Esternocleidomast√≥ideo | Sentado ou em p√©, incline suavemente a cabe√ßa para um lado, como se quisesse tocar a orelha no ombro. Use a m√£o do lado oposto para dar um leve pux√£o (se necess√°rio). | Fa√ßa o movimento lentamente. Relaxe o ombro que est√° sendo alongado (oposto) para maximizar o efeito.",

            // ================== 7. INFORMA√á√ïES NUTRICIONAIS ==================
            "Prote√≠na | Nutri√ß√£o | Macronutriente | Constru√ß√£o e Reparo Muscular | Essencial para a s√≠ntese de prote√≠nas musculares (Hipertrofia) e para o reparo das microles√µes geradas durante o treino de for√ßa. | Ingest√£o adequada (principalmente em doses p√≥s-treino) √© vital para otimizar a recupera√ß√£o e o crescimento muscular.",
            "Carboidrato | Nutri√ß√£o | Macronutriente | Fonte de Energia Prim√°ria (Glicog√™nio) | Principal combust√≠vel para exerc√≠cios de alta intensidade e longa dura√ß√£o. Armazenado como glicog√™nio no f√≠gado e nos m√∫sculos. | O consumo pr√©-treino fornece energia e o p√≥s-treino √© crucial para repor as reservas de glicog√™nio esgotadas.",
            "Gordura (Lip√≠dios) | Nutri√ß√£o | Macronutriente | Reserva de Energia e Produ√ß√£o Hormonal | Serve como fonte de energia para exerc√≠cios de baixa intensidade e dura√ß√£o prolongada. √â fundamental para a produ√ß√£o de horm√¥nios (como a testosterona). | Embora seja fonte de energia, √© vital para a sa√∫de celular, fun√ß√µes cerebrais e absor√ß√£o de vitaminas lipossol√∫veis.",
            "√Ågua | Nutri√ß√£o | Micronutriente | Hidrata√ß√£o, Regula√ß√£o T√©rmica | Essencial para o transporte de nutrientes, regula√ß√£o da temperatura corporal e lubrifica√ß√£o das articula√ß√µes. | A desidrata√ß√£o, mesmo leve, pode prejudicar drasticamente o desempenho no treino e a recupera√ß√£o.",
            "Creatina | Nutri√ß√£o | Suplemento | For√ßa e Pot√™ncia Muscular | Ajuda a regenerar o ATP (a principal fonte de energia r√°pida para exerc√≠cios de alta intensidade). | √â um dos suplementos mais estudados e eficazes para aumentar a for√ßa e o volume muscular.",
            "Whey Protein | Nutri√ß√£o | Suplemento | Recupera√ß√£o e S√≠ntese Proteica | Fonte r√°pida e completa de prote√≠na (alto valor biol√≥gico), ideal para o p√≥s-treino imediato. | Deve ser usado para complementar a ingest√£o di√°ria de prote√≠na se a dieta n√£o for suficiente.",

            // ================== 8. SA√öDE E ALERTAS ==================
            "Dor Aguda/Ponta | Sa√∫de e Alerta | Sintoma de Alerta | Poss√≠vel Les√£o | Dor s√∫bita, intensa, que pode indicar um problema articular ou muscular mais s√©rio. | Pare o exerc√≠cio imediatamente. N√£o continue a treinar com dor aguda. Procure um profissional de sa√∫de/fisioterapeuta.",
            "Tontura ou Vertigem | Sa√∫de e Alerta | Sintoma de Alerta | Desidrata√ß√£o/Press√£o Baixa/Exaust√£o | Sensa√ß√£o de desmaio iminente ou desequil√≠brio durante o exerc√≠cio. | Pare o exerc√≠cio, sente-se ou deite-se. Beba √°gua e espere a recupera√ß√£o. Pode ser desidrata√ß√£o, hipoglicemia (baixa de a√ß√∫car) ou hipotens√£o (press√£o baixa). | Verifique o n√≠vel de glicose se for diab√©tico e hidrate-se bem antes e durante o treino.",
            "Falta de Ar Anormal | Sa√∫de e Alerta | Sintoma de Alerta | Dificuldade Respirat√≥ria | Dificuldade para respirar ou uma sensa√ß√£o de 'f√¥lego incompleto' que √© desproporcional √† intensidade do exerc√≠cio. | Diminua a intensidade drasticamente ou pare. Observe se a respira√ß√£o normaliza rapidamente. Se persistir, procure ajuda. | Pode ser um sinal de problemas card√≠acos ou respirat√≥rios.",
        ];

        // --- FUN√á√ïES DE CARGA (GR√ÅFICO) ---

        // Dados de treino pr√©-definidos (podem ser personalizados)
        const treinos = {
            'Dia A': [
                { nome: 'Agachamento Livre', series: '3', repeticoes: '8-12', observacoes: 'Com progress√£o de carga.' },
                { nome: 'Leg Press 45¬∞', series: '3', repeticoes: '10-15', observacoes: 'N√£o travar o joelho.' },
                { nome: 'Cadeira Extensora', series: '3', repeticoes: '15-20', observacoes: 'Foco na contra√ß√£o no topo.' },
                { nome: 'Cadeira Adutora', series: '3', repeticoes: '12-15', observacoes: 'Controlar a fase negativa.' },
                { nome: 'Eleva√ß√£o de Panturrilha em P√©', series: '4', repeticoes: '15-20', observacoes: 'M√°xima amplitude.' },
            ],
            'Dia B': [
                { nome: 'Supino Reto', series: '3', repeticoes: '8-12', observacoes: 'Progress√£o de carga.' },
                { nome: 'Supino Inclinado', series: '3', repeticoes: '10-15', observacoes: 'Foco na parte superior do peito.' },
                { nome: 'Crossover (Cabo)', series: '3', repeticoes: '12-15', observacoes: 'Focar na contra√ß√£o interna.' },
                { nome: 'Desenvolvimento Militar', series: '3', repeticoes: '8-12', observacoes: 'Evitar arquear a lombar.' },
                { nome: 'Eleva√ß√£o Lateral', series: '3', repeticoes: '12-15', observacoes: 'Movimento lento e controlado.' },
                { nome: 'Tr√≠ceps Testa', series: '3', repeticoes: '10-15', observacoes: 'Cotovelos fixos.' },
                { nome: 'Tr√≠ceps Pulley (Corda)', series: '3', repeticoes: '12-15', observacoes: 'Abrir a corda no final.' },
            ],
            'Dia C': [
                { nome: 'Puxada Alta (Lat Pulldown)', series: '3', repeticoes: '8-12', observacoes: 'Conectar com a esc√°pula.' },
                { nome: 'Remada Curvada com Barra', series: '3', repeticoes: '8-12', observacoes: 'Tronco fixo.' },
                { nome: 'Remada Sentada (Cabo)', series: '3', repeticoes: '10-15', observacoes: 'Retra√ß√£o m√°xima da esc√°pula.' },
                { nome: 'Hiperextens√£o Lombar', series: '3', repeticoes: '12-15', observacoes: 'Foco no gl√∫teo e lombar.' },
                { nome: 'Rosca Direta com Barra', series: '3', repeticoes: '10-15', observacoes: 'Cotovelos fixos.' },
                { nome: 'Rosca Alternada', series: '3', repeticoes: '10-15', observacoes: 'Foco na supina√ß√£o do pulso.' },
                { nome: 'Abdominal Crunch', series: '4', repeticoes: '15-20', observacoes: 'Sentir o abd√¥men "enrolar".' },
            ]
        };

        function renderizarListaDeTreino(dia) {
            const listaEl = document.getElementById(`lista-treino-${dia.toLowerCase().replace('dia ', '')}`);
            if (!listaEl) return;
            
            const exercicios = treinos[dia] || [];
            let html = '';

            if (exercicios.length === 0) {
                html = `<li class="exercicio-item" style="background: none; border: none; color: #ff9933;">Nenhum exerc√≠cio definido para ${dia}.</li>`;
            } else {
                exercicios.forEach(ex => {
                    html += `
                        <li class="exercicio-item">
                            <div class="exercicio-info">
                                <strong data-nome="${ex.nome}">${ex.nome}</strong>
                                <p style="margin: 0; font-size: 0.85em; color: #aaa;">
                                    ${ex.series} S√©ries de ${ex.repeticoes} Reps.
                                </p>
                                <p style="margin: 3px 0 0 0; font-size: 0.75em; color: #ff8c00;">
                                    ${ex.observacoes}
                                </p>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" data-nome="${ex.nome}" onchange="marcarConcluido(this)">
                            </div>
                        </li>
                    `;
                });
            }

            listaEl.innerHTML = html;
            carregarConcluidos(dia); // Carrega status do firebase ap√≥s renderizar a lista
        }

        function alternarTreino() {
            const seletor = document.getElementById('seletorTreino');
            const dia = seletor.value;

            document.querySelectorAll('.lista-treino-dia').forEach(div => {
                div.style.display = 'none';
            });

            const treinoDiv = document.getElementById(`treino-${dia}`);
            if (treinoDiv) {
                treinoDiv.style.display = 'block';
                renderizarListaDeTreino(dia);
            }
        }
        
        // Inicializa o primeiro treino na carga
        document.addEventListener('DOMContentLoaded', () => {
             alternarTreino();
        });


        // --- FUN√á√ïES DE INTERA√á√ÉO ---
        
        function obterNomeAluno() {
            const storedName = localStorage.getItem('alunoNome');
            if (storedName) {
                alunoNome = storedName;
                document.getElementById('main-title').textContent = `Bem-vindo(a), ${alunoNome}.`;
                document.getElementById('nome-aluno').textContent = alunoNome;
                // Carregar dados ap√≥s o nome
                inicializarApp();
            } else {
                // Abre o modal
                document.getElementById('modal-nome').style.display = 'flex';
                document.getElementById('nomeModalInput').focus();
            }
        }

        function salvarNomeModal() {
            const nomeInput = document.getElementById('nomeModalInput').value.trim();
            if (nomeInput) {
                alunoNome = nomeInput.split(' ')[0]; // Pega s√≥ o primeiro nome
                localStorage.setItem('alunoNome', alunoNome);
                document.getElementById('modal-nome').style.display = 'none';
                document.getElementById('main-title').textContent = `Bem-vindo(a), ${alunoNome}.`;
                document.getElementById('nome-aluno').textContent = alunoNome;
                // Carregar dados
                inicializarApp();
            } else {
                alert('Por favor, insira seu nome.');
            }
        }

        function inicializarApp() {
            // Configura a data
            const hoje = new Date();
            const dataLegivel = hoje.toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit', year:'numeric'});
            document.getElementById('data-atual').textContent = dataLegivel;

            // Carrega dados iniciais
            alternarTreino(); // Renderiza o treino do dia A
            gerarCalendario(); // Gera e carrega a presenca
            carregarUltimoTreino(); // √öltimo treino finalizado
            contarTreinosDoMes(); // Total de treinos no m√™s
            carregarTreinosFinalizados(); // Carrega hist√≥rico e gr√°fico de treinos
            carregarUltimasMedidas(); // Carrega √∫ltimas medidas
            inicializarGrafico(); // Carrega o gr√°fico de progress√£o de carga

        }

        // --- FUN√á√ïES DE PROGRESS√ÉO DE CARGA (GR√ÅFICO) ---

        function inicializarGrafico() {
            const exercicio = document.getElementById('seletorExercicio').value;
            const ref = database.ref(getPath(`cargas/${exercicio}`));
            
            ref.on('value', snap => {
                const cargas = [];
                snap.forEach(child => {
                    const c = child.val();
                    cargas.push({
                        peso: parseFloat(c.peso),
                        data: c.data
                    });
                });
                
                // Ordenar por data (opcional, mas bom para garantir)
                cargas.sort((a, b) => new Date(a.data.split('/').reverse().join('-')) - new Date(b.data.split('/').reverse().join('-')));
                
                renderizarGrafico(exercicio, cargas);
            });
        }

        function renderizarGrafico(exercicio, cargas) {
            const canvas = document.getElementById('pesoChart');
            if (!canvas) return;

            const labels = cargas.map(c => c.data);
            const data = cargas.map(c => c.peso);
            
            if (typeof Chart === 'undefined') {
                console.warn('Chart.js n√£o carregado');
                return;
            }

            const ctx = canvas.getContext('2d');
            if (pesoChart) pesoChart.destroy(); // Destr√≥i o gr√°fico anterior
            
            pesoChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `Carga Registrada (${exercicio}) em Kg`,
                        data: data,
                        borderColor: '#ff8c00', // Cor do Dark Mode
                        backgroundColor: 'rgba(255, 140, 0, 0.2)',
                        borderWidth: 2,
                        pointRadius: 5,
                        pointBackgroundColor: '#ff8c00',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Carga (kg)',
                                color: '#f0f0f0'
                            },
                            ticks: {
                                color: '#f0f0f0'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Data',
                                color: '#f0f0f0'
                            },
                            ticks: {
                                color: '#f0f0f0'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#f0f0f0'
                            }
                        }
                    }
                }
            });
        }

        function adicionarPeso() {
            const exercicio = document.getElementById('seletorExercicio').value;
            const pesoInput = document.getElementById('pesoInput');
            const peso = parseFloat(pesoInput.value);

            if (isNaN(peso) || peso <= 0) {
                alert('Por favor, insira uma carga v√°lida.');
                return;
            }

            const agora = new Date();
            const dataLegivel = agora.toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit', year:'numeric'});

            const payload = {
                peso: peso,
                data: dataLegivel,
                timestamp: Date.now()
            };

            // Salva no Firebase
            database.ref(getPath(`cargas/${exercicio}`)).push(payload)
                .then(() => {
                    alert(`Carga de ${peso}kg registrada para ${exercicio} com sucesso!`);
                    pesoInput.value = ''; // Limpa o campo
                    inicializarGrafico(); // Atualiza o gr√°fico
                })
                .catch(error => {
                    console.error("Erro ao registrar carga:", error);
                    alert("Erro ao registrar carga. Tente novamente.");
                });
        }


        // --- FUN√á√ïES DE MEDIDAS ---

        function registrarMedidas() {
            const peso = parseFloat(document.getElementById('pesoCorporalInput').value);
            const cintura = parseFloat(document.getElementById('cinturaInput').value);
            const braco = parseFloat(document.getElementById('bracoInput').value);
            const torax = parseFloat(document.getElementById('toraxInput').value);
            const abdomen = parseFloat(document.getElementById('abdomenInput').value);
            const coxa = parseFloat(document.getElementById('coxaInput').value);
            const panturrilha = parseFloat(document.getElementById('panturrilhaInput').value);
            const antebraco = parseFloat(document.getElementById('antebracoInput').value);


            if (isNaN(peso) && isNaN(cintura) && isNaN(braco) && isNaN(torax) && isNaN(abdomen) && isNaN(coxa) && isNaN(panturrilha) && isNaN(antebraco)) {
                alert('Por favor, preencha pelo menos um campo de medida.');
                return;
            }

            const agora = new Date();
            const dataLegivel = agora.toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit', year:'numeric'});
            
            const payload = {
                data: dataLegivel,
                timestamp: Date.now(),
            };
            
            if (!isNaN(peso)) payload.peso = peso;
            if (!isNaN(cintura)) payload.cintura = cintura;
            if (!isNaN(braco)) payload.braco = braco;
            if (!isNaN(torax)) payload.torax = torax;
            if (!isNaN(abdomen)) payload.abdomen = abdomen;
            if (!isNaN(coxa)) payload.coxa = coxa;
            if (!isNaN(panturrilha)) payload.panturrilha = panturrilha;
            if (!isNaN(antebraco)) payload.antebraco = antebraco;

            // Salva no Firebase
            database.ref(getPath('medidas')).push(payload)
                .then(() => {
                    alert('Medidas registradas com sucesso!');
                    // Limpa os campos
                    document.getElementById('pesoCorporalInput').value = '';
                    document.getElementById('cinturaInput').value = '';
                    document.getElementById('bracoInput').value = '';
                    document.getElementById('toraxInput').value = '';
                    document.getElementById('abdomenInput').value = '';
                    document.getElementById('coxaInput').value = '';
                    document.getElementById('panturrilhaInput').value = '';
                    document.getElementById('antebracoInput').value = '';
                    // Atualiza a lista
                    carregarUltimasMedidas();
                })
                .catch(error => {
                    console.error("Erro ao registrar medidas:", error);
                    alert("Erro ao registrar medidas. Tente novamente.");
                });
        }

        function carregarUltimasMedidas() {
            const ref = database.ref(getPath('medidas'));
            ref.orderByChild('timestamp').limitToLast(1).on('value', snap => {
                const div = document.getElementById('ultimasMedidas');
                if (!div) return;
                
                if (!snap.exists()) {
                    div.innerHTML = 'Nenhum registro encontrado.';
                    return;
                }
                
                let ultimaMedida = null;
                snap.forEach(child => {
                    ultimaMedida = child.val();
                });
                
                if (ultimaMedida) {
                    let html = `<p style="font-weight:bold;margin-bottom:8px;">√öltimo registro: ${ultimaMedida.data}</p>`;
                    html += '<ul style="list-style:none;padding:0;text-align:left;max-width:200px;margin:0 auto;">';
                    
                    const campos = {
                        peso: 'Peso (kg)',
                        cintura: 'Cintura (cm)',
                        braco: 'Bra√ßo D. (cm)',
                        torax: 'T√≥rax (cm)',
                        abdomen: 'Abd√¥men (cm)',
                        coxa: 'Coxa D. (cm)',
                        panturrilha: 'Panturrilha (cm)',
                        antebraco: 'Antebra√ßo (cm)',
                    };
                    
                    Object.keys(campos).forEach(key => {
                        if (ultimaMedida[key]) {
                            html += `<li><strong>${campos[key]}:</strong> ${ultimaMedida[key]}</li>`;
                        }
                    });
                    
                    html += '</ul>';
                    div.innerHTML = html;
                }
            });
        }


        // --- FUN√á√ïES DE CHECKBOX DE TREINO ---
        
        function carregarConcluidos(dia) {
            const idLista = `lista-treino-${dia.toLowerCase().replace('dia ', '')}`;
            const listaEl = document.getElementById(idLista);
            if (!listaEl) return;
            
            const ref = database.ref(getPath(`statusTreino/${dia}`));
            ref.once('value').then(snap => {
                const status = snap.val() || {};
                
                listaEl.querySelectorAll('input[type=\"checkbox\"]').forEach(cb => {
                    const nomeEx = cb.getAttribute('data-nome');
                    if (status[nomeEx] && status[nomeEx].concluido) {
                        cb.checked = true;
                        cb.closest('li').classList.add('concluido');
                    } else {
                        cb.checked = false;
                        cb.closest('li').classList.remove('concluido');
                    }
                });
            }).catch(e => console.warn('Erro ao carregar conclu√≠dos:', e));
        }

        function marcarConcluido(checkbox) {
            const dia = document.getElementById('seletorTreino').value;
            const nomeEx = checkbox.getAttribute('data-nome');
            const li = checkbox.closest('li');
            const isChecked = checkbox.checked;
            
            const ref = database.ref(getPath(`statusTreino/${dia}/${nomeEx}`));
            
            if (isChecked) {
                ref.set({ concluido: true, timestamp: Date.now() })
                    .then(() => li.classList.add('concluido'))
                    .catch(e => console.error('Erro ao marcar:', e));
            } else {
                ref.remove()
                    .then(() => li.classList.remove('concluido'))
                    .catch(e => console.error('Erro ao desmarcar:', e));
            }
        }
        
        
        // --- FUN√á√ïES DE CALEND√ÅRIO / PRESEN√áA ---
        
        function gerarCalendario() {
            const agora = new Date();
            const anoAtual = agora.getFullYear();
            const mesAtual = agora.getMonth(); // 0 = Jan
            
            const dataInicio = new Date(anoAtual, mesAtual, 1);
            const primeiroDiaSemana = dataInicio.getDay(); // 0 = Dom, 6 = Sab
            const ultimoDiaMes = new Date(anoAtual, mesAtual + 1, 0).getDate();

            let html = '';
            let contadorDias = 1;

            for (let i = 0; i < 6; i++) {
                html += '<tr>';
                for (let j = 0; j < 7; j++) {
                    if (i === 0 && j < primeiroDiaSemana) {
                        html += '<td></td>';
                    } else if (contadorDias > ultimoDiaMes) {
                        html += '<td></td>';
                    } else {
                        const chaveData = `${String(contadorDias).padStart(2,'0')}-${String(mesAtual+1).padStart(2,'0')}-${anoAtual}`;
                        html += `<td id="dia-${chaveData}" onclick="togglePresenca('${chaveData}')">${contadorDias}</td>`;
                        contadorDias++;
                    }
                }
                html += '</tr>';
                if (contadorDias > ultimoDiaMes) break;
            }
            document.getElementById('calendario-body').innerHTML = html;
            carregarPresencas();
        }

        function togglePresenca(key) {
            const td = document.getElementById(`dia-${key}`);
            const status = td.classList.contains('presente');

            if (status) {
                database.ref(getPath(`presenca/${key}`)).remove();
                td.classList.remove('presente');
            } else {
                database.ref(getPath(`presenca/${key}`)).set(true);
                td.classList.add('presente');
            }
        }

        function carregarPresencas() {
            database.ref(getPath('presenca')).on('value', snap => {
                const p = snap.val() || {};
                document.querySelectorAll('#calendario-body td').forEach(td => td.classList.remove('presente'));
                Object.keys(p).forEach(k => {
                    const td = document.getElementById(`dia-${k}`);
                    if (td) td.classList.add('presente');
                });
            });
        }


        // --- INTERA√á√ÉO COM IA (L√ìGICA CORRIGIDA E MELHORADA) ---

        async function simularPesquisaIA() {
            const pergunta = document.getElementById('exercicioPergunta').value.trim().toLowerCase();
            const perguntaNormalizada = normalize(pergunta);
            const respostaDiv = document.getElementById('ai-resposta');
            respostaDiv.innerHTML = '<p style="color:#ff9933; text-align:center;">Buscando...</p>';

            if (!pergunta) {
                respostaDiv.innerHTML = '<p style="color:#ccc; text-align:center;">Por favor, digite uma pergunta.</p>';
                return;
            }

            // 1. Tentar encontrar exerc√≠cio e informa√ß√µes
            let exercicioEncontrado = null;
            let nomeEx = '';
            
            const exerciciosMap = rawData.map(item => {
                const [nome, categoria, foco, musculos, execucao, dica] = item.split(' | ');
                return { nome: normalize(nome), nomeOriginal: nome, musculos: musculos, execucao: execucao, dica: dica, categoria: categoria, foco: foco };
            });

            for (const ex of exerciciosMap) {
                if (perguntaNormalizada.includes(ex.nome)) {
                    exercicioEncontrado = ex;
                    nomeEx = ex.nomeOriginal;
                    break;
                }
            }
            
            let respostaTexto = '';
            
            if (exercicioEncontrado) {
                if (perguntaNormalizada.includes("m√∫sculo") || perguntaNormalizada.includes("ativado") || perguntaNormalizada.includes("treina")) {
                    respostaTexto = `**M√∫sculos Ativados em ${nomeEx}:** ${exercicioEncontrado.musculos}`;
                } else if (perguntaNormalizada.includes("como") || perguntaNormalizada.includes("forma correta") || perguntaNormalizada.includes("fazer") || perguntaNormalizada.includes("tecnica")) {
                    respostaTexto = `**Execu√ß√£o do ${nomeEx}:** ${exercicioEncontrado.execucao}\n\n**Dica Importante:** ${exercicioEncontrado.dica}`;
                } else if (perguntaNormalizada.includes("dica") || perguntaNormalizada.includes("seguran√ßa")) {
                    respostaTexto = `**Dica de Seguran√ßa para ${nomeEx}:** ${exercicioEncontrado.dica}`;
                } else { // Resposta padr√£o se o t√≥pico n√£o for espec√≠fico
                    respostaTexto = `**Informa√ß√µes sobre ${nomeEx}**\n\n**M√∫sculos:** ${exercicioEncontrado.musculos}\n\n**Como Fazer:** ${exercicioEncontrado.execucao}\n\n**Dica:** ${exercicioEncontrado.dica}`;
                }
            } else if (perguntaNormalizada.includes("nutri√ß√£o") || perguntaNormalizada.includes("creatina") || perguntaNormalizada.includes("prote√≠na") || perguntaNormalizada.includes("carboidrato")) {
                 const infoNutricional = exerciciosMap.filter(item => item.categoria === 'Nutri√ß√£o' && perguntaNormalizada.includes(item.nome));
                 if(infoNutricional.length > 0) {
                     const item = infoNutricional[0];
                     respostaTexto = `**${item.nomeOriginal}:** ${item.foco}\n\n**Detalhes:** ${item.execucao}\n\n**Import√¢ncia:** ${item.dica}`;
                 } else {
                      respostaTexto = "**T√≥picos de Nutri√ß√£o Dispon√≠veis:** Prote√≠na, Carboidrato, Gordura (Lip√≠dios), √Ågua, Creatina, Whey Protein. Por favor, pergunte sobre um destes t√≥picos. Ex: 'O que √© Creatina?'";
                 }

            } else if (perguntaNormalizada.includes("dor") || perguntaNormalizada.includes("tontura") || perguntaNormalizada.includes("falta de ar")) {
                const infoSaude = exerciciosMap.filter(item => item.categoria.includes('Sa√∫de') && perguntaNormalizada.includes(item.nome));
                 if(infoSaude.length > 0) {
                     const item = infoSaude[0];
                     respostaTexto = `**Alerta: ${item.nomeOriginal}**\n\n**Sintoma:** ${item.musculos}\n\n**O que Fazer:** ${item.execucao}\n\n**Cuidado Adicional:** ${item.dica}`;
                 } else {
                     respostaTexto = "**Alertas de Sa√∫de Dispon√≠veis:** Dor Aguda/Ponta, Tontura ou Vertigem, Falta de Ar Anormal. Por favor, pergunte sobre um destes. Ex: 'O que fazer com Dor Aguda?'";
                 }
            } else {
                respostaTexto = "Desculpe, n√£o encontrei informa√ß√µes espec√≠ficas sobre esse exerc√≠cio/t√≥pico. Tente perguntar o nome de um exerc√≠cio (ex: 'Agachamento Livre') ou um t√≥pico de sa√∫de/nutri√ß√£o.";
            }

            // Exibe a resposta final (com um pequeno delay para simular o "pensamento" da IA)
            setTimeout(() => {
                 document.getElementById('ai-resposta').innerHTML = respostaTexto;
            }, 500);

        }


        // --- FUN√á√ïES DE RESET DE DADOS ---
        
        function resetarDados(tipo) {
            let path;
            let msg;

            switch (tipo) {
                case 'presenca':
                    path = 'presenca';
                    msg = 'hist√≥rico de presen√ßas';
                    break;
                case 'cargas':
                    path = `cargas/${document.getElementById('seletorExercicio').value}`;
                    msg = 'hist√≥rico de cargas para este exerc√≠cio';
                    break;
                case 'medidas':
                    path = 'medidas';
                    msg = 'hist√≥rico de medidas corporais';
                    break;
                default:
                    return;
            }

            if (confirm(`Tem certeza que deseja apagar o ${msg}? Isso n√£o pode ser desfeito.`)) {
                database.ref(getPath(path)).remove()
                    .then(() => {
                        alert('Hist√≥rico apagado com sucesso!');
                        if (tipo === 'presenca') gerarCalendario();
                        if (tipo === 'cargas') inicializarGrafico();
                        if (tipo === 'medidas') document.getElementById('ultimasMedidas').innerHTML = 'Nenhum registro encontrado.';
                    })
                    .catch(error => {
                        console.error("Erro ao resetar dados:", error);
                        alert("Erro ao apagar dados.");
                    });
            }
        }
    </script>
</body>

</html>
