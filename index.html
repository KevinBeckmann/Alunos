<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard do Aluno - Dark Mode</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>

    <style>
        /* ================================================= */
        /* === IN√çCIO DO CSS: DARK MODE, 3 COLUNAS E RESPONSIVO === */
        /* ================================================= */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #000000;
            color: #f0f0f0;
        }

        /* Navega√ß√£o Simples */
        nav {
            text-align: right;
            margin-bottom: 10px;
        }
        nav a {
            color: #ff8c00;
            text-decoration: none;
            font-size: 0.9em;
        }
        nav a:hover {
            text-decoration: underline;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
            gap: 20px;
            text-align: center;
        }

        .header-content img {
            max-width: 80px;
            height: auto;
            border-radius: 10px;
        }

        .header-content h1 {
            color: #ff8c00;
            margin: 0;
            font-size: 2.2em;
            line-height: 1.2;
        }

        @media (max-width: 767px) {
            .header-content {
                justify-content: flex-start;
                text-align: left;
            }

            .header-content h1 {
                font-size: 1.8em;
                width: 100%;
                margin-top: 10px;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            gap: 20px;
            width: 100%;
            justify-content: center;
            grid-template-columns: 1fr;
        }

        .card {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 12px;
            box-shadow: none;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chart-container {
            min-height: 300px;
            position: relative;
            margin-bottom: 20px;
        }

        #medidas-card {
            order: 2;
        }

        /* --- LAYOUT PARA TABLET (2 COLUNAS) --- */
        @media (min-width: 768px) {
            .container {
                grid-template-columns: 1fr 1fr;
            }
            #chart-card {
                grid-column: 1 / 3;
                order: 1;
            }
        }

        /* --- LAYOUT PARA DESKTOP (3 COLUNAS) --- */
        @media (min-width: 1024px) {
            .container {
                grid-template-columns: 1fr 1fr 1fr;
            }
            #chart-card {
                grid-column: auto;
                order: initial;
            }
        }

        /* SELECTS */
        #seletorExercicio,
        #seletorTreino {
            padding: 8px;
            border-radius: 4px;
            background-color: rgba(255, 255, 255, 0.1);
            color: #f0f0f0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 15px;
            width: 100%;
            box-sizing: border-box;
            font-size: 1em;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23ff9933" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 8px center;
            padding-right: 30px;
        }

        #seletorExercicio option,
        #seletorTreino option {
            background-color: #1a1a1a;
            color: #f0f0f0;
            border: none;
        }

        h2 {
            color: #ff9933;
            margin-top: 0;
            margin-bottom: 15px;
        }

        #treino-card h2 {
            margin-top: 0; /* Ajustado */
        }

        /* TREINO LISTA */
        .exercicio-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: background-color 0.3s;
            color: #f0f0f0;
        }

        .exercicio-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .exercicio-info strong {
            font-size: 1.1em;
            display: block;
            margin-bottom: 5px;
        }

        .checkbox-container input[type="checkbox"] {
            transform: scale(1.3);
            cursor: pointer;
        }

        .concluido {
            background-color: rgba(56, 112, 56, 0.5); /* Verde escuro transparente */
            text-decoration: line-through;
            color: #a0a0a0;
        }

        /* TABELA PRESEN√áA */
        .presenca-table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
            margin-top: 10px;
        }

        .presenca-table th,
        .presenca-table td {
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .presenca-table th {
            background-color: #ff8c00;
            color: #000;
            font-weight: bold;
        }

        .presente {
            background-color: #28a745 !important;
            color: white;
        }

        .presenca-table td:hover {
            background-color: rgba(255, 255, 255, 0.15);
        }

        /* INPUTS */
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            flex-wrap: nowrap;
        }

        .input-group label {
            width: 110px; 
            flex-shrink: 0;
            font-size: 0.9em;
            color: #ccc;
        }

        .input-group input[type="number"] {
            padding: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            flex-grow: 1;
            background-color: rgba(255, 255, 255, 0.1);
            color: #f0f0f0;
            width: 100%;
        }

        .input-group button {
            padding: 8px 15px;
            background-color: #ffc107;
            color: #333;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .input-group button:hover {
            background-color: #e0a800;
        }

        /* RESET BUTTONS */
        .card button.reset-btn {
            margin-top: 15px;
            padding: 10px;
            background-color: rgba(220, 53, 69, 0.8);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s;
        }

        .card button.reset-btn:hover {
            background-color: #c9302c;
        }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #1a1a1a;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 0 20px rgba(255, 140, 0, 0.3);
            text-align: center;
            border: 1px solid #ff8c00;
        }

        .modal-content h3 {
            color: #ff8c00;
            margin-bottom: 20px;
        }

        .modal-content img {
            max-width: 100px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        #nomeModalInput {
            width: 100%;
            padding: 12px;
            border: 1px solid #ff8c00;
            border-radius: 4px;
            background-color: #333;
            color: #f0f0f0;
            box-sizing: border-box;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        #botaoSalvarNome {
            background-color: #ff8c00;
            color: #000;
            border: none;
            padding: 12px 25px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: background-color 0.3s;
            width: 100%;
        }

        #botaoSalvarNome:hover {
            background-color: #e07b00;
        }

        /* ================================================= */
        /* === FIM DO CSS === */
        /* ================================================= */
    </style>
</head>

<body onload="obterNomeAluno()">

    <nav>
        <a href="professor03.html">Acessar √Årea do Professor</a>
    </nav>

    <div id="modal-nome" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3>Bem-vindo(a) ao seu Dashboard!</h3>
            <p>Por favor, insira seu nome para personalizarmos sua √°rea:</p>
            <input type="text" id="nomeModalInput" placeholder="Ex: Maria da Silva">
            <button id="botaoSalvarNome" onclick="salvarNomeModal()">Entrar</button>
        </div>
    </div>

    <div class="header-content">
        <h1 id="main-title">Seja bem-vindo ao seu Espa√ßo.</h1>
    </div>

    <div class="container">

        <div id="chart-card" class="card">
            <h2>üìà Progress√£o de Carga</h2>

            <label for="seletorExercicio">Visualizar Exerc√≠cio:</label>
            <select id="seletorExercicio" onchange="inicializarGrafico()">
                <option value="AgachamentoLivre">Agachamento Livre</option>
                <option value="SupinoReto">Supino Reto</option>
                <option value="PuxadaFrontal">Puxada Frontal</option>
                <option value="LevantamentoTerra">Levantamento Terra</option>
            </select>
            <div class="chart-container">
                <canvas id="pesoChart"></canvas>
            </div>
            <div class="input-group">
                <label for="pesoInput">Carga (kg):</label>
                <input type="number" id="pesoInput" placeholder="Ex: 20" step="0.5">
                <button onclick="adicionarPeso()">Registrar</button>
            </div>

            <button class="reset-btn" onclick="resetarDados('cargas')">Resetar Hist√≥rico deste Exerc√≠cio</button>
        </div>

        <div id="medidas-card" class="card">
            <h2>üìè Registro de Medidas</h2>
            <p style="margin-bottom: 15px; font-size: 0.9em; color: #ccc;">Acompanhe sua evolu√ß√£o corporal.</p>

            <div class="input-group">
                <label for="pesoCorporalInput">Peso Corp. (kg)</label>
                <input type="number" id="pesoCorporalInput" placeholder="Ex: 75.5" step="0.1">
            </div>

            <div class="input-group">
                <label for="cinturaInput">Cintura (cm)</label>
                <input type="number" id="cinturaInput" placeholder="Ex: 80" step="1">
            </div>

            <div class="input-group">
                <label for="bracoInput">Bra√ßo D. (cm)</label>
                <input type="number" id="bracoInput" placeholder="Ex: 35" step="0.5">
            </div>
            
            <div class="input-group">
                <label for="toraxInput">T√≥rax (cm)</label>
                <input type="number" id="toraxInput" placeholder="Ex: 100" step="1">
            </div>

            <div class="input-group">
                <label for="abdomenInput">Abd√¥men (cm)</label>
                <input type="number" id="abdomenInput" placeholder="Ex: 85" step="1">
            </div>

            <div class="input-group">
                <label for="coxaInput">Coxa D. (cm)</label>
                <input type="number" id="coxaInput" placeholder="Ex: 55" step="0.5">
            </div>

            <div class="input-group">
                <label for="panturrilhaInput">Panturrilha (cm)</label>
                <input type="number" id="panturrilhaInput" placeholder="Ex: 40" step="0.5">
            </div>

            <div class="input-group">
                <label for="antebracoInput">Antebra√ßo (cm)</label>
                <input type="number" id="antebracoInput" placeholder="Ex: 30" step="0.5">
            </div>
            <div class="input-group">
                <button onclick="registrarMedidas()" style="width:100%">Salvar Medidas</button>
            </div>

            <hr style="border-color: rgba(255,255,255,0.1);">
            <h3 style="margin-top: 15px; color: #ff9933; font-size: 1.1em;">√öltimo Registro:</h3>
            <div id="ultimasMedidas" style="font-size: 0.9em; line-height: 1.6;">
                <em style="color: #999;">Nenhum registro encontrado.</em>
            </div>

            <button class="reset-btn" onclick="resetarDados('medidas')">Apagar Todas Medidas</button>
        </div>

        <div id="treino-card" class="card">
            <h2>üèãÔ∏è Treino do Dia</h2>

            <label for="seletorTreino">Selecionar Ficha:</label>
            <select id="seletorTreino" onchange="alternarTreino()">
                <option value="Dia A">Dia A - Peito/Ombro/Tr√≠ceps</option>
                <option value="Dia B">Dia B - Costas/B√≠ceps</option>
                <option value="Dia C">Dia C - Pernas</option>
            </select>
            <hr style="border-color: rgba(255, 255, 255, 0.2); margin: 20px 0;">

            <p style="font-size: 0.9em;">
                <strong>Aluno:</strong> <span id="nome-aluno" style="color: #ff8c00;">...</span><br>
                <strong>Data:</strong> <span id="data-atual"></span>
            </p>

            <div id="treino-Dia A" class="lista-treino-dia">
                <ul id="lista-treino-a" class="lista-treino" style="list-style: none; padding: 0;">
                    <li class="exercicio-item" data-exercicio="Esteira">
                        <div class="exercicio-info">
                            <strong>Esteira</strong>
                            <span>30 Minutos | 1 Vez</span>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" onchange="marcarConcluido(this, 'Dia A', 'Esteira')">
                        </div>
                    </li>
                    <li class="exercicio-item" data-exercicio="SupinoInclinado">
                        <div class="exercicio-info">
                            <strong>Supino Inclinado</strong>
                            <span>4x12 | 90s</span>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" onchange="marcarConcluido(this, 'Dia A', 'SupinoInclinado')">
                        </div>
                    </li>
                    <li class="exercicio-item" data-exercicio="Crucifixo">
                        <div class="exercicio-info">
                            <strong>Crucifixo</strong>
                            <span>4x12 | 60s</span>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" onchange="marcarConcluido(this, 'Dia A', 'Crucifixo')">
                        </div>
                    </li>
                </ul>
            </div>

            <div id="treino-Dia B" class="lista-treino-dia" style="display: none;">
                <ul id="lista-treino-b" class="lista-treino" style="list-style: none; padding: 0;">
                    <li class="exercicio-item" data-exercicio="PuxadaFrontal">
                        <div class="exercicio-info">
                            <strong>Puxada Frontal</strong>
                            <span>4x12 | 60s</span>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" onchange="marcarConcluido(this, 'Dia B', 'PuxadaFrontal')">
                        </div>
                    </li>
                    <li class="exercicio-item" data-exercicio="RemadaCurvada">
                        <div class="exercicio-info">
                            <strong>Remada Curvada</strong>
                            <span>4x10 | 90s</span>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" onchange="marcarConcluido(this, 'Dia B', 'RemadaCurvada')">
                        </div>
                    </li>
                     <li class="exercicio-item" data-exercicio="RoscaDireta">
                        <div class="exercicio-info">
                            <strong>Rosca Direta</strong>
                            <span>3x12 | 45s</span>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" onchange="marcarConcluido(this, 'Dia B', 'RoscaDireta')">
                        </div>
                    </li>
                </ul>
            </div>

            <div id="treino-Dia C" class="lista-treino-dia" style="display: none;">
                <ul id="lista-treino-c" class="lista-treino" style="list-style: none; padding: 0;">
                    <li class="exercicio-item" data-exercicio="LegPress">
                        <div class="exercicio-info">
                            <strong>Leg Press 45¬∞</strong>
                            <span>4x10 | 90s</span>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" onchange="marcarConcluido(this, 'Dia C', 'LegPress')">
                        </div>
                    </li>
                    <li class="exercicio-item" data-exercicio="CadeiraExtensora">
                        <div class="exercicio-info">
                            <strong>Cadeira Extensora</strong>
                            <span>4x15 | 60s</span>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" onchange="marcarConcluido(this, 'Dia C', 'CadeiraExtensora')">
                        </div>
                    </li>
                     <li class="exercicio-item" data-exercicio="Panturrilha">
                        <div class="exercicio-info">
                            <strong>Panturrilha em P√©</strong>
                            <span>4x15 | 60s</span>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" onchange="marcarConcluido(this, 'Dia C', 'Panturrilha')">
                        </div>
                    </li>
                </ul>
            </div>

        </div>

        <div id="presenca-card" class="card">
            <h2>üóìÔ∏è Presen√ßa Mensal</h2>
            <p style="font-size: 0.9em; color: #ccc;">Clique no dia para marcar presen√ßa.</p>
            <table class="presenca-table" id="tabela-presenca">
                <thead>
                    <tr>
                        <th>D</th>
                        <th>S</th>
                        <th>T</th>
                        <th>Q</th>
                        <th>Q</th>
                        <th>S</th>
                        <th>S</th>
                    </tr>
                </thead>
                <tbody id="calendario-body">
                    </tbody>
            </table>
            <div style="margin-top: 10px; font-size: 0.8em; text-align: center; color: #888;">
                * Exibindo m√™s atual
            </div>
        </div>

    </div>

    <script>
        // ==========================================================
        // CONFIGURA√á√ÉO FIREBASE
        // ==========================================================
        const firebaseConfig = {
            apiKey: "AIzaSyQDLkdyL4qgoEj1YqBr2xCs0F3aM1o82ef0",
            authDomain: "ptf03-26fdb.firebaseapp.com",
            databaseURL: "https://ptf03-26fdb-default-rtdb.firebaseio.com",
            projectId: "ptf03-26fdb",
            storageBucket: "ptf03-26fdb.firebaseapp.com",
            messagingSenderId: "1020981883676",
            appId: "1:1020981883676:web:7b26aca25ddb1dc02100d9"
        };

        // Inicializa o Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Vari√°veis Globais
        const STORAGE_KEY_NOME = 'nomeAluno';
        const FIREBASE_PATH_USUARIO = 'alunos/';
        let alunoNome = '';
        let pesoChart;

        // Mapeamento para nomes no banco
        const EXERCICIO_KEYS = {
            'AgachamentoLivre': 'agachamentoLivre',
            'SupinoReto': 'supinoReto',
            'PuxadaFrontal': 'puxadaFrontal',
            'LevantamentoTerra': 'levantamentoTerra'
        };

        // ==========================================================
        // 1. GEST√ÉO DE NOME E INICIALIZA√á√ÉO
        // ==========================================================

        function obterNomeAluno() {
            alunoNome = localStorage.getItem(STORAGE_KEY_NOME);
            if (!alunoNome) {
                abrirModalNome();
                document.getElementById('nome-aluno').textContent = "...";
            } else {
                atualizarInterfaceUsuario();
                inicializarApp();
            }
        }

        function abrirModalNome() {
            document.getElementById('modal-nome').style.display = 'flex';
            document.getElementById('nomeModalInput').focus();
        }

        function salvarNomeModal() {
            let nomeInput = document.getElementById('nomeModalInput').value;
            if (nomeInput && nomeInput.trim() !== "") {
                // Formata para Primeira Letra Mai√∫scula
                alunoNome = nomeInput.trim().split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ');
                localStorage.setItem(STORAGE_KEY_NOME, alunoNome);
                document.getElementById('modal-nome').style.display = 'none';
                
                atualizarInterfaceUsuario();
                inicializarApp();
            } else {
                alert('Por favor, digite seu nome.');
            }
        }

        function atualizarInterfaceUsuario() {
            document.getElementById('nome-aluno').textContent = alunoNome;
            document.getElementById('main-title').textContent = `Ol√°, ${alunoNome.split(' ')[0]}!`;
            exibirDataAtual();
        }

        function exibirDataAtual() {
            const date = new Date();
            document.getElementById('data-atual').textContent = date.toLocaleDateString('pt-BR');
        }

        function inicializarApp() {
            inicializarGrafico();
            carregarUltimasMedidas();
            alternarTreino(); // Carrega o estado dos checkboxes
            gerarCalendario();
        }

        function getFirebasePath(subPath) {
            const nomeSanitized = alunoNome.replace(/[.#$/\[\]]/g, '_'); // Remove caracteres inv√°lidos
            return `${FIREBASE_PATH_USUARIO}${nomeSanitized}/${subPath}`;
        }

        // ==========================================================
        // 2. GR√ÅFICOS (CHART.JS) E CARGAS
        // ==========================================================

        function inicializarGrafico() {
            const exercicioSelect = document.getElementById('seletorExercicio');
            const exercicioKey = exercicioSelect.value;
            const exercicioNome = exercicioSelect.options[exercicioSelect.selectedIndex].text;
            const dbPath = getFirebasePath(`cargas/${EXERCICIO_KEYS[exercicioKey]}`);

            document.querySelector('#chart-card h2').innerHTML = `üìà Carga: ${exercicioNome}`;

            // Listener em tempo real
            database.ref(dbPath).on('value', (snapshot) => {
                const dados = [];
                snapshot.forEach(child => dados.push(child.val()));

                // Prepara dados
                const labels = dados.map(d => d.data);
                const values = dados.map(d => d.peso);

                renderizarChart(labels, values, exercicioNome);
            });
        }

        function renderizarChart(labels, dataValues, labelName) {
            const ctx = document.getElementById('pesoChart').getContext('2d');

            if (pesoChart) {
                pesoChart.destroy();
            }

            pesoChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels.length ? labels : ['In√≠cio'],
                    datasets: [{
                        label: 'Peso (kg)',
                        data: dataValues.length ? dataValues : [0],
                        borderColor: '#ff8c00',
                        backgroundColor: 'rgba(255, 140, 0, 0.2)',
                        pointBackgroundColor: '#ff8c00',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#f0f0f0' } }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#ccc' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        x: {
                            ticks: { color: '#ccc' },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    }
                }
            });
        }

        function adicionarPeso() {
            const peso = document.getElementById('pesoInput').value;
            const exercicioKey = document.getElementById('seletorExercicio').value;

            if (!peso) return alert("Digite o peso!");

            const novoRegistro = {
                data: new Date().toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }),
                peso: parseFloat(peso)
            };

            const dbPath = getFirebasePath(`cargas/${EXERCICIO_KEYS[exercicioKey]}`);
            database.ref(dbPath).push(novoRegistro)
                .then(() => {
                    document.getElementById('pesoInput').value = '';
                    alert('Carga registrada!');
                })
                .catch(erro => console.error(erro));
        }

        // ==========================================================
        // 3. MEDIDAS CORPORAIS
        // ==========================================================

        function registrarMedidas() {
            const medidas = {
                data: new Date().toLocaleDateString('pt-BR'),
                peso: document.getElementById('pesoCorporalInput').value,
                cintura: document.getElementById('cinturaInput').value,
                braco: document.getElementById('bracoInput').value,
                torax: document.getElementById('toraxInput').value,
                abdomen: document.getElementById('abdomenInput').value,
                coxa: document.getElementById('coxaInput').value,
                panturrilha: document.getElementById('panturrilhaInput').value,
                antebraco: document.getElementById('antebracoInput').value
            };

            // Valida√ß√£o simples (pelo menos o peso)
            if (!medidas.peso) return alert("Pelo menos o Peso Corporal √© obrigat√≥rio.");

            const dbPath = getFirebasePath('medidas');
            database.ref(dbPath).push(medidas)
                .then(() => {
                    alert("Medidas salvas com sucesso!");
                    // Limpar inputs
                    document.querySelectorAll('#medidas-card input').forEach(i => i.value = '');
                    carregarUltimasMedidas();
                });
        }

        function carregarUltimasMedidas() {
            const dbPath = getFirebasePath('medidas');
            
            // Pega apenas o √∫ltimo registro
            database.ref(dbPath).limitToLast(1).once('value', (snapshot) => {
                const divDisplay = document.getElementById('ultimasMedidas');
                divDisplay.innerHTML = ''; 

                if (!snapshot.exists()) {
                    divDisplay.innerHTML = '<em style="color: #999;">Nenhum registro encontrado.</em>';
                    return;
                }

                snapshot.forEach(child => {
                    const m = child.val();
                    let html = `<strong>Data: ${m.data}</strong><br>`;
                    if(m.peso) html += `Peso: ${m.peso}kg | `;
                    if(m.cintura) html += `Cintura: ${m.cintura}cm | `;
                    if(m.braco) html += `Bra√ßo: ${m.braco}cm<br>`;
                    if(m.abdomen) html += `Abd√¥men: ${m.abdomen}cm | `;
                    if(m.coxa) html += `Coxa: ${m.coxa}cm`;
                    
                    divDisplay.innerHTML = html;
                });
            });
        }

        // ==========================================================
        // 4. TREINO (CHECKBOXES)
        // ==========================================================

        function alternarTreino() {
            const diaSelecionado = document.getElementById('seletorTreino').value;
            
            // Esconde todos e mostra o selecionado
            document.querySelectorAll('.lista-treino-dia').forEach(div => div.style.display = 'none');
            document.getElementById(`treino-${diaSelecionado}`).style.display = 'block';

            // Carregar estado dos checkboxes do Firebase para esse dia
            carregarCheckboxes(diaSelecionado);
        }

        function marcarConcluido(checkbox, dia, exercicioId) {
            const li = checkbox.closest('li');
            if (checkbox.checked) {
                li.classList.add('concluido');
            } else {
                li.classList.remove('concluido');
            }

            // Salvar estado no Firebase (sobrescreve o valor boolean)
            const dbPath = getFirebasePath(`treino_status/${dia}/${exercicioId}`);
            database.ref(dbPath).set(checkbox.checked);
        }

        function carregarCheckboxes(dia) {
            const dbPath = getFirebasePath(`treino_status/${dia}`);
            database.ref(dbPath).once('value', (snapshot) => {
                const status = snapshot.val() || {};
                
                // Itera sobre os exerc√≠cios do dia vis√≠vel
                const container = document.getElementById(`treino-${dia}`);
                const items = container.querySelectorAll('.exercicio-item');

                items.forEach(item => {
                    const id = item.getAttribute('data-exercicio');
                    const checkbox = item.querySelector('input[type="checkbox"]');
                    
                    if (status[id] === true) {
                        checkbox.checked = true;
                        item.classList.add('concluido');
                    } else {
                        checkbox.checked = false;
                        item.classList.remove('concluido');
                    }
                });
            });
        }

        // ==========================================================
        // 5. PRESEN√áA (CALEND√ÅRIO)
        // ==========================================================

        function gerarCalendario() {
            const tbody = document.getElementById('calendario-body');
            tbody.innerHTML = '';

            const hoje = new Date();
            const ano = hoje.getFullYear();
            const mes = hoje.getMonth(); // 0 a 11

            const primeiroDiaMes = new Date(ano, mes, 1).getDay(); // 0 (Dom) a 6 (Sab)
            const diasNoMes = new Date(ano, mes + 1, 0).getDate();

            let diaContador = 1;
            let html = '';

            // Loop para criar semanas (linhas)
            for (let i = 0; i < 6; i++) {
                html += '<tr>';
                for (let j = 0; j < 7; j++) {
                    if (i === 0 && j < primeiroDiaMes) {
                        html += '<td></td>'; // C√©lula vazia antes do dia 1
                    } else if (diaContador > diasNoMes) {
                        html += '<td></td>'; // C√©lula vazia depois do fim do m√™s
                    } else {
                        // Formato de chave para o Firebase: DD-MM-AAAA
                        const chaveData = `${String(diaContador).padStart(2,'0')}-${String(mes+1).padStart(2,'0')}-${ano}`;
                        html += `<td id="dia-${chaveData}" onclick="alternarPresenca('${chaveData}')">${diaContador}</td>`;
                        diaContador++;
                    }
                }
                html += '</tr>';
                if (diaContador > diasNoMes) break;
            }
            tbody.innerHTML = html;

            carregarPresencas(mes + 1, ano);
        }

        function alternarPresenca(dataKey) {
            const td = document.getElementById(`dia-${dataKey}`);
            const dbPath = getFirebasePath(`presenca/${dataKey}`);
            
            // Verifica se j√° est√° marcado visualmente para decidir o toggle
            const estaPresente = td.classList.contains('presente');

            if (estaPresente) {
                // Remove
                database.ref(dbPath).remove().then(() => td.classList.remove('presente'));
            } else {
                // Adiciona
                database.ref(dbPath).set(true).then(() => td.classList.add('presente'));
            }
        }

        function carregarPresencas(mes, ano) {
            // Carrega toda a presen√ßa do usu√°rio e filtra visualmente
            const dbPath = getFirebasePath('presenca');
            database.ref(dbPath).once('value', (snapshot) => {
                if (!snapshot.exists()) return;

                const presencas = snapshot.val();
                Object.keys(presencas).forEach(dataKey => {
                    // dataKey √© "DD-MM-AAAA"
                    const partes = dataKey.split('-');
                    // Se for do m√™s/ano atual do calend√°rio exibido
                    if (parseInt(partes[1]) === mes && parseInt(partes[2]) === ano) {
                        const td = document.getElementById(`dia-${dataKey}`);
                        if (td) td.classList.add('presente');
                    }
                });
            });
        }

        // ==========================================================
        // 6. FUN√á√ïES DE RESET
        // ==========================================================

        function resetarDados(tipo) {
            let confirmacao = confirm(`Tem certeza que deseja apagar os dados de: ${tipo.toUpperCase()}? Essa a√ß√£o n√£o pode ser desfeita.`);
            if (!confirmacao) return;

            let path = '';
            if (tipo === 'cargas') {
                const exercicio = document.getElementById('seletorExercicio').value;
                path = `cargas/${EXERCICIO_KEYS[exercicio]}`;
            } else if (tipo === 'medidas') {
                path = 'medidas';
            } else if (tipo === 'treino_presenca') {
                // Exemplo de reset composto (opcional)
                // Para simplicidade, aqui n√£o implementado bot√£o espec√≠fico no HTML para isso,
                // mas voc√™ pode criar um bot√£o que chama resetarDados('geral')
                return; 
            }

            if (path) {
                const dbPath = getFirebasePath(path);
                database.ref(dbPath).remove()
                    .then(() => {
                        alert('Dados apagados com sucesso.');
                        // Atualiza tela
                        if(tipo === 'cargas') inicializarGrafico();
                        if(tipo === 'medidas') carregarUltimasMedidas();
                    })
                    .catch(err => alert('Erro ao apagar: ' + err.message));
            }
        }

    </script>
</body>

</html>
