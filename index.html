<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard do Aluno - Dark Mode</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>

    <style>
        /* --- ESTILOS GERAIS --- */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #000000;
            color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        nav {
            width: 100%;
            max-width: 1200px;
            text-align: right;
            margin-bottom: 10px;
        }

        nav a {
            color: #ff8c00;
            text-decoration: none;
            font-size: 0.9em;
        }

        /* HEADER */
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
            gap: 20px;
            text-align: center;
            max-width: 100%;
        }

        .header-content img {
            max-width: 80px;
            height: auto;
            border-radius: 10px;
        }

        .header-content h1 {
            color: #ff8c00;
            margin: 0;
            font-size: 2.2em;
            line-height: 1.2;
        }

        /* LAYOUT RESPONSIVO (GRID) */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            gap: 20px;
            width: 100%;
            justify-content: center;
            grid-template-columns: 1fr;
        }

        @media (min-width: 768px) {
            .container {
                grid-template-columns: 1fr 1fr;
            }

            #chart-card {
                grid-column: 1 / 3;
                order: 1;
            }
        }

        @media (min-width: 1024px) {
            .container {
                grid-template-columns: 1fr 1fr 1fr;
            }

            #chart-card {
                grid-column: auto;
                order: initial;
            }
        }

        /* CARDS */
        .card {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #medidas-card {
            order: 2;
        }

        /* FORMUL√ÅRIOS E INPUTS */
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            justify-content: space-between;
        }

        .input-group label {
            width: 95px;
            flex-shrink: 0;
            font-size: 0.9em;
            color: #ccc;
        }

        /* NOVO CONTAINER DE INPUT PARA CENTRALIZAR O CARD DE MEDIDAS */
        #medidas-card .input-container {
            max-width: 350px;
            margin: 0 auto 15px auto;
        }

        #medidas-card .input-group {
            width: 100%;
        }

        .input-group input,
        select {
            flex-grow: 1;
            padding: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #f0f0f0;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }

        select {
            margin-bottom: 15px;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23ff9933" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 8px center;
            padding-right: 30px;
        }

        select option {
            background-color: #1a1a1a;
        }

        /* TITULOS */
        h2 {
            color: #ff9933;
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
        }

        /* CONTAINER DO GR√ÅFICO */
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
            margin-bottom: 20px;
        }

        /* LISTA DE TREINO */
        .exercicio-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: background-color 0.3s;
        }

        .exercicio-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .exercicio-info strong {
            font-size: 1.1em;
            display: block;
            margin-bottom: 5px;
        }

        .checkbox-container input[type="checkbox"] {
            transform: scale(1.3);
            cursor: pointer;
        }

        .concluido {
            background-color: #387038;
            opacity: 0.7;
            text-decoration: line-through;
            color: #a0a0a0;
        }

        /* TABELA PRESEN√áA */
        .presenca-table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
        }

        .presenca-table th,
        .presenca-table td {
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px;
            cursor: pointer;
        }

        .presenca-table th {
            background-color: #ff8c00;
            color: white;
        }

        .presente {
            background-color: #5cb85c !important;
            color: white;
        }

        /* BOT√ïES */
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-primary {
            background-color: #ffc107;
            color: #333;
        }

        .btn-primary:hover {
            background-color: #e0a800;
        }

        .reset-btn {
            margin-top: 15px;
            background-color: #dc3545;
            color: white;
        }

        .reset-btn:hover {
            background-color: #c9302c;
        }

        /* MODAL */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #0d0d0d;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 2px solid #ff8c00;
        }

        .modal-content img {
            max-width: 100px;
            margin-bottom: 20px;
        }

        #botaoSalvarNome {
            background-color: #ff8c00;
            color: #000;
            margin-top: 10px;
        }

        /* --- CAMPO DE PESQUISA IA --- */
        #ai-search-card {
            order: 3;
            background-color: #1a1a1a;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #ai-search-card textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background-color: #000000;
            color: #f0f0f0;
            resize: vertical;
            box-sizing: border-box;
        }

        #ai-resposta {
            margin-top: 15px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: transparent;
            border-radius: 8px;
            min-height: 50px;
            font-size: 0.9em;
            color: #ccc;
            white-space: pre-wrap;
        }

        #ai-resposta strong {
            color: #ff9933;
        }
    </style>
</head>

<body onload="obterNomeAluno()">

    <nav>
        <a href="professor.html">Acessar a P√°gina do Professor</a>
    </nav>

    <div id="modal-nome" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <img src="logotipo.png" alt="Logo PTF3" onerror="this.style.display='none'">
            <h3>Bem-vindo(a)!</h3>
            <p>Por favor, insira seu nome:</p>
            <input type="text" id="nomeModalInput" placeholder="Ex: Maria da Silva"
                style="width: 100%; padding: 10px; margin-bottom: 10px;">
            <button id="botaoSalvarNome" onclick="salvarNomeModal()">Entrar</button>
        </div>
    </div>

    <div class="header-content">
        <img src="logotipo.png" alt="Logo PTF3" onerror="this.style.display='none'">
        <h1 id="main-title">Seja bem-vindo ao seu Espa√ßo.</h1>
    </div>

    <div class="container">

        <div id="chart-card" class="card">
            <h2> Progress√£o de Carga</h2>
            <label for="seletorExercicio">Visualizar Exerc√≠cio:</label>
            <select id="seletorExercicio" onchange="inicializarGrafico()">
                <option value="AgachamentoLivre">Agachamento Livre</option>
                <option value="SupinoReto">Supino Reto</option>
                <option value="PuxadaFrontal">Puxada Frontal</option>
                <option value="RoscaDireta">Rosca Direta</option>
                <option value="TricepsTesta">Tr√≠ceps Testa</option>
                <option value="DesenvolvimentoMilitar">Desenvolvimento Militar</option>
                <option value="CadeiraExtensora">Cadeira Extensora</option>
                <option value="ElevacaoPelvica">Eleva√ß√£o P√©lvica</option>
            </select>

            <div class="chart-container">
                <canvas id="pesoChart"></canvas>
            </div>

            <div class="input-group">
                <input type="number" id="pesoInput" placeholder="Carga (kg)" step="0.5">
                <button class="btn-primary" onclick="adicionarPeso()">Registrar Carga</button>
            </div>
            <button class="reset-btn" onclick="resetarDados('cargas')">Resetar Hist√≥rico</button>
        </div>

        <div id="medidas-card" class="card">
            <h2> Registro de Medidas</h2>
            <p style="margin-bottom: 15px; font-size: 0.9em; color: #ccc; text-align: center;">Acompanhe sua evolu√ß√£o.
            </p>

            <div class="input-container">
                <div class="input-group"><label>Peso (kg)</label><input type="number" id="pesoCorporalInput"
                        placeholder="Ex: 75.5" step="0.1"></div>
                <div class="input-group"><label>Cintura</label><input type="number" id="cinturaInput" placeholder="cm"
                        step="1"></div>
                <div class="input-group"><label>Bra√ßo D.</label><input type="number" id="bracoInput" placeholder="cm"
                        step="0.5"></div>
                <div class="input-group"><label>T√≥rax</label><input type="number" id="toraxInput" placeholder="cm"
                        step="1">
                </div>
                <div class="input-group"><label>Abd√¥men</label><input type="number" id="abdomenInput" placeholder="cm"
                        step="1"></div>
                <div class="input-group"><label>Coxa D.</label><input type="number" id="coxaInput" placeholder="cm"
                        step="0.5"></div>
                <div class="input-group"><label>Panturrilha</label><input type="number" id="panturrilhaInput"
                        placeholder="cm" step="0.5"></div>
                <div class="input-group"><label>Antebra√ßo</label><input type="number" id="antebracoInput" placeholder="cm"
                        step="0.5"></div>
            </div>

            <button class="btn-primary" onclick="registrarMedidas()">Registrar Medidas</button>

            <h3 style="margin-top: 15px; color: #ff9933; text-align: center;">√öltimos Registros</h3>
            <div id="ultimasMedidas" style="font-size: 0.9em; color: #ccc; text-align: center;">Nenhum registro
                encontrado.</div>
            <button class="reset-btn" onclick="resetarDados('medidas')">Resetar Medidas</button>
        </div>

        <div id="treino-card" class="card">
            <h2> Treino de For√ßa</h2>

            <label for="seletorTreino">Selecionar Dia:</label>
            <select id="seletorTreino" onchange="alternarTreino()">
                <option value="Dia A">Dia A - Peito/Ombro/Tr√≠ceps</option>
                <option value="Dia B">Dia B - Costas/B√≠ceps</option>
                <option value="Dia C">Dia C - Pernas</option>
            </select>
            <hr style="border-color: rgba(255, 255, 255, 0.2);">

            <p style="text-align: center;"><strong>Aluno:</strong> <span id="nome-aluno" style="color:#ff8c00">...</span>
                | <strong>Data:</strong>
                <span id="data-atual"></span></p>

            <div id="treino-Dia A" class="lista-treino-dia">
                <h3>Dia A: Peito, Ombros e Tr√≠ceps</h3>
                <ul id="lista-treino-a" style="list-style: none; padding: 0;">
                    <li class="exercicio-item" style="background: none; border: none; color: #ff9933;">Carregando treino...
                    </li>
                </ul>
            </div>

            <div id="treino-Dia B" class="lista-treino-dia" style="display: none;">
                <h3>Dia B: Costas e B√≠ceps</h3>
                <ul id="lista-treino-b" style="list-style: none; padding: 0;">
                    <li class="exercicio-item" style="background: none; border: none; color: #ff9933;">Carregando treino...
                    </li>
                </ul>
            </div>

            <div id="treino-Dia C" class="lista-treino-dia" style="display: none;">
                <h3>Dia C: Pernas</h3>
                <ul id="lista-treino-c" style="list-style: none; padding: 0;">
                    <li class="exercicio-item" style="background: none; border: none; color: #ff9933;">Carregando treino...
                    </li>
                </ul>
            </div>
        </div>

        <div id="ai-search-card" class="card">
            <h2> Pesquisar Exerc√≠cio com IA</h2>

            <label for="exercicioPergunta">O que voc√™ gostaria de saber sobre o exerc√≠cio?</label>
            <textarea id="exercicioPergunta" placeholder="Ex: 'Qual a forma correta de fazer agachamento?'
ou 'Estou com dor no peito durante o treino' ou 'O que √© prote√≠na?'"></textarea>

            <button class="btn-primary" onclick="simularPesquisaIA()">Perguntar √† IA</button>

            <h3 style="margin-top: 15px; color: #ff9933; text-align: center;">Resposta da IA</h3>
            <div id="ai-resposta">
                O resultado da sua pesquisa aparecer√° aqui. (Fun√ß√£o de IA simulada)
            </div>
        </div>
        <div id="presenca-card" class="card">
            <h2> Presen√ßa Mensal</h2>

            <p style="text-align: center;">Clique nas datas para marcar.</p>
            <table class="presenca-table">
                <thead>
                    <tr>
                        <th>Dom</th>
                        <th>Seg</th>
                        <th>Ter</th>
                        <th>Qua</th>
                        <th>Qui</th>
                        <th>Sex</th>
                        <th>S√°b</th>
                    </tr>
                </thead>
                <tbody id="calendario-body"></tbody>
            </table>
            <button class="reset-btn" onclick="resetarDados('presenca')">Resetar Presen√ßas</button>
        </div>

    </div>

    <script>
        // CONFIGURA√á√ÉO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyQDLkdyL4qgoEj1YqBr2xCs0F3aM1o82ef0",
            authDomain: "ptf03-26fdb.firebaseapp.com",
            databaseURL: "https://ptf03-26fdb-default-rtdb.firebaseio.com",
            projectId: "ptf03-26fdb",
            storageBucket: "ptf03-26fdb.firebaseapp.com",
            messagingSenderId: "1020981883676",
            appId: "1:1020981883676:web:7b26aca25ddb1dc02100d9"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let alunoNome = '';
        let pesoChart;
        function getPath(sub) {
            // Remove espa√ßos e garante que a chave do aluno seja formatada corretamente (Ex: Maria_Da_Silva)
            return `alunos/${alunoNome.replace(/\s/g, '_')}/${sub}`;
        }

        // --- BANCO DE DADOS LOCAL (IA SIMULADA) ---
        // Fun√ß√£o para normalizar strings (remover acentos e caracteres especiais)
        const normalize = (str) => str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();

        // Dados brutos fornecidos (Exerc√≠cios, Nutri√ß√£o e Sa√∫de)
        const rawData = [
            "Supino Reto | Muscula√ß√£o | Peito | Peitoral Maior, Delt√≥ide Anterior, Tr√≠ceps | Deite no banco, p√©s firmes no ch√£o. Segure a barra na largura dos ombros. Des√ßa-a controladamente at√© o peito. Empurre a barra para cima, estendendo os bra√ßos. | Mantenha as esc√°pulas retra√≠das (ombros para tr√°s e para baixo) para estabilizar e proteger a articula√ß√£o do ombro.",
            "Crucifixo com Halteres | Muscula√ß√£o | Peito | Peitoral Maior (Foco no alongamento) | Deitado, segure os halteres acima do peito. Des√ßa os bra√ßos lateralmente com os cotovelos levemente flexionados (travados). Retorne, simulando um abra√ßo. | O movimento deve ser controlado e o arco amplo. Pare antes que os ombros fiquem em hiperextens√£o.",
            "Puxada Alta (Lat Pulldown) | Muscula√ß√£o | Costas | Lat√≠ssimo do Dorso (Grande Dorsal), B√≠ceps, Romboides | Sentado na m√°quina, joelhos travados. Puxe a barra em dire√ß√£o ao peito, inclinando levemente o tronco para tr√°s. Concentre-se em conectar o movimento com a retra√ß√£o das esc√°pulas. | Evite o impulso do tronco. Concentre-se em 'puxar com os cotovelos' para isolar as costas.",
            "Remada Curvada com Barra | Muscula√ß√£o | Costas | Lat√≠ssimo do Dorso, Romboides, Trap√©zio | Incline o tronco para frente a cerca de 45 graus, mantendo a coluna neutra e o peito alto. Puxe a barra em dire√ß√£o √† parte inferior do abd√¥men. | Mantenha a cabe√ßa alinhada com a coluna e evite arredondar as costas para proteger a lombar. ",
            "Desenvolvimento Militar | Muscula√ß√£o | Ombros | Delt√≥ide Anterior e Medial, Tr√≠ceps | Em p√© (ou sentado com apoio), comece com a barra/halteres na altura dos ombros. Empurre o peso verticalmente para cima at√© a extens√£o completa. | Mantenha o core (abd√¥men) contra√≠do e evite arquear a lombar (hiperextens√£o) durante o empurr√£o.",
            "Eleva√ß√£o Lateral | Muscula√ß√£o | Ombros | Delt√≥ide Medial (Lateral) | Em p√©, segure halteres ao lado do corpo. Levante os bra√ßos lateralmente em arco at√© a altura dos ombros. Mantenha os cotovelos levemente flexionados. | N√£o use o impulso do corpo. O movimento deve ser suave e o delt√≥ide deve fazer o trabalho, sem sobrecarregar o trap√©zio superior.",
            "Rosca Direta com Barra | Muscula√ß√£o | B√≠ceps | B√≠ceps Braquial, Braquial | Em p√©, segure a barra com pegada supinada (palmas para cima). Mantenha os cotovelos fixos e pr√≥ximos ao corpo. Flexione-os, levantando a barra em dire√ß√£o ao peito. | Os cotovelos devem permanecer fixos e ao lado do corpo. Evite balan√ßar o tronco (roubar) para preservar a tens√£o no b√≠ceps.",
            "Tr√≠ceps Testa | Muscula√ß√£o | Tr√≠ceps | Tr√≠ceps Braquial (principalmente a cabe√ßa longa) | Deitado em um banco, segure a barra ou halteres. Flexione os cotovelos, baixando o peso em dire√ß√£o √† testa. Estenda os bra√ßos para retornar. | Mantenha os cotovelos apontando para a frente (n√£o para os lados) e use um peso que permita total controle do movimento.",
            "Agachamento Livre | Muscula√ß√£o | Pernas/Gl√∫teos | Quadr√≠ceps, Gl√∫teo M√°ximo, Isquiotibiais | Com a barra nas costas, des√ßa o quadril como se fosse sentar em uma cadeira, mantendo o peito alto e a coluna neutra. Os joelhos devem seguir a dire√ß√£o dos p√©s. | A profundidade ideal √© abaixo de 90 graus (se a mobilidade permitir). Distribua o peso nos calcanhares e evite que os joelhos 'caiam' para dentro. ",
            "Leg Press | Muscula√ß√£o | Pernas/Gl√∫teos | Quadr√≠ceps, Gl√∫teo M√°ximo | Sente-se na m√°quina, posicione os p√©s na plataforma. Des√ßa a plataforma flexionando os joelhos e empurre-a de volta, sem travar completamente os joelhos no topo. | Mantenha a lombar completamente apoiada no encosto. Reduza a amplitude se sentir que o quadril est√° saindo do banco.",
            "Levantamento Terra Romeno (Stiff) | Muscula√ß√£o | Posterior/Gl√∫teos | Isquiotibiais (Posterior da coxa), Gl√∫teo M√°ximo, Eratores da Espinha | Em p√©, segure a barra/halteres. Incline o tronco para frente, empurrando o quadril para tr√°s, mantendo as pernas quase esticadas. | O movimento √© uma 'dobra' do quadril. Mantenha a coluna neutra e sinta o alongamento concentrado na parte posterior da coxa.",
            "Cadeira Extensora | Muscula√ß√£o | Quadr√≠ceps | Quadr√≠ceps (Isolamento) | Sentado na m√°quina, estenda as pernas contra a almofada at√© a total contra√ß√£o do m√∫sculo. Volte controladamente, resistindo ao peso. | Conscientemente, contraia o quadr√≠ceps no topo do movimento antes de retornar, garantindo o m√°ximo recrutamento.",
            "Eleva√ß√£o P√©lvica (Hip Thrust) | Muscula√ß√£o | Gl√∫teos | Gl√∫teo M√°ximo, Isquiotibiais | Apoie as esc√°pulas em um banco. Coloque a barra sobre o quadril. Contraia o gl√∫teo para levantar o quadril at√© formar uma linha reta com ombros e joelhos. | Mantenha o queixo abaixado e a costela 'para dentro'. A for√ßa vem da contra√ß√£o m√°xima do gl√∫teo no topo.",
            "Prancha (Plank) | Muscula√ß√£o | Core/Abd√¥men | Reto Abdominal, Obl√≠quos, Transverso do Abd√¥men | Apoie-se nos antebra√ßos e pontas dos p√©s. Mantenha o corpo em linha reta, desde a cabe√ßa at√© os calcanhares. | Puxe o umbigo em dire√ß√£o √† coluna para ativar o m√∫sculo transverso. Evite arquear a lombar ou levantar o quadril.",
            "Agachamento Low Bar (Barra Baixa) | Powerlifting | Agachamento | Gl√∫teo M√°ximo, Isquiotibiais, Quadr√≠ceps | A barra √© posicionada mais baixa nas costas (na parte posterior do delt√≥ide). Des√ßa priorizando a inclina√ß√£o do tronco e o impulso do quadril. | Exige maior mobilidade de ombro e tornozelo. A t√©cnica √© voltada para maximizar a carga, mantendo o padr√£o de movimento competitivo.",
            "Supino com Pausa | Powerlifting | Supino | Peitoral, Delt√≥ide Anterior, Tr√≠ceps | Des√ßa a barra at√© o peito. Mantenha-a completamente im√≥vel por 1-2 segundos no peito (pausa). S√≥ ent√£o empurre a barra para cima. | Esta pausa √© um requisito de competi√ß√£o. Fortalece o m√∫sculo sem depender do impulso el√°stico do 'rebote' no peito.",
            "Levantamento Terra Convencional | Powerlifting | Terra | Cadeia Posterior (Lombar, Gl√∫teos, Isquiotibiais), Trap√©zio | Fique com os p√©s na largura do quadril. Segure a barra fora dos joelhos. Puxe o peso do ch√£o, esticando o quadril e os joelhos simultaneamente. | A coluna deve ser neutra (reta) durante todo o movimento. Mantenha o peso o mais pr√≥ximo poss√≠vel do corpo. ",
            "Supino com Pegada Fechada (Acess√≥rio) | Powerlifting | Auxiliar | Tr√≠ceps Braquial, Peitoral (por√ß√£o interna) | Similar ao supino reto, mas as m√£os ficam mais pr√≥ximas (na largura dos ombros). Des√ßa e empurre o peso focado na for√ßa do tr√≠ceps. | Usado especificamente para aumentar a for√ßa de 'lockout' (finaliza√ß√£o da extens√£o) no supino principal.",
            "Snatch (Arranco) | CrossFit | LPO | Corpo Inteiro (Quadr√≠ceps, Trap√©zio, Ombros, Core) | Movimento explosivo: a barra √© puxada do ch√£o at√© acima da cabe√ßa em um √∫nico movimento, terminando em um agachamento completo. | A chave √© a 'triple extension' (extens√£o explosiva de tornozelos, joelhos e quadril) para acelerar a barra antes de se mover para baixo dela.",
            "Clean & Jerk (Arremesso) | CrossFit | LPO | Corpo Inteiro (Pernas, Ombros, Core) | Clean (Limpo): Levar a barra do ch√£o para os ombros. Jerk (Arremesso): Usar a for√ßa das pernas (em split ou push) para levar a barra dos ombros para cima da cabe√ßa. | √â crucial receber a barra na posi√ß√£o correta (rack frontal) e usar as pernas para a segunda parte (Jerk).",
            "Thruster | CrossFit | LPO/Gin√°stica | Quadr√≠ceps, Delt√≥ides, Tr√≠ceps | Agachamento Frontal seguido imediatamente por um Desenvolvimento Militar (Press) em um movimento fluido e sem pausas. | Use a for√ßa de impuls√£o das pernas ao sair do agachamento para transferir a energia para o empurr√£o do peso acima da cabe√ßa.",
            "Pull-up (Kipado) | CrossFit | Gin√°stica | Grande Dorsal, B√≠ceps, Core | Pendurado na barra, use o balan√ßo r√≠tmico do corpo (Kip) e do quadril para auxiliar a eleva√ß√£o e levar o queixo sobre a barra. | Sempre comece e mantenha a tens√£o no core (posi√ß√£o 'Hollow' e 'Arch') para controlar o balan√ßo e evitar les√µes no ombro.",
            "Muscle-up (Argola/Barra) | CrossFit | Gin√°stica | Grande Dorsal, Peitoral, Tr√≠ceps, Core | Transi√ß√£o da Puxada vertical para o Mergulho (Dip) sobre o aparelho. Exige for√ßa e coordena√ß√£o para 'se projetar' sobre o anel/barra. | O timing da transi√ß√£o √© o mais dif√≠cil. √â um movimento completo que exige for√ßa de puxada (back) e empurr√£o (tr√≠ceps/peito). ",
            "Toes-to-Bar (T2B) | CrossFit | Gin√°stica | Core (Reto Abdominal e Flexores do Quadril) | Pendurado na barra, use o balan√ßo do corpo (kip) controlado para levantar os p√©s at√© que toquem a barra (entre as m√£os). | O movimento deve ser controlado pelo core; evite balan√ßar descontroladamente. Foque em manter a forma 'Hollow' e 'Arch'.",
            "Burpee | CrossFit | Condicionamento | Corpo Inteiro | Deite-se no ch√£o (peito e quadris tocam), levante, salte com os p√©s para perto das m√£os e salte para o alto, batendo as m√£os acima da cabe√ßa. | √â um movimento de corpo inteiro e alta intensidade. O foco √© na fluidez e velocidade entre a transi√ß√£o do ch√£o para o salto.",
            "Wall Ball Shot | CrossFit | Condicionamento | Quadr√≠ceps, Gl√∫teos, Ombros | Segurando a bola medicinal no peito, fa√ßa um agachamento completo. Use a for√ßa explosiva das pernas para levantar e arremessar a bola no alvo na parede. | Certifique-se de que o quadril des√ßa abaixo da paralela no agachamento. Use a in√©rcia do quadril para impulsionar a bola.",
            "The Hundred (O Cem) | Pilates | Mat/Solo | Transverso do Abd√¥men (Core), Reto Abdominal | Deitado de costas, levante a cabe√ßa e os ombros. Pernas a 45 graus. Bombeie os bra√ßos ritmicamente. A respira√ß√£o √© coordenada (5 inspira√ß√µes e 5 expira√ß√µes por ciclo). | Mantenha a lombar pressionada contra o solo ativamente. A respira√ß√£o profunda e controlada (no ritmo 5/5) √© o foco do exerc√≠cio. ",
            "Roll Up | Pilates | Mat/Solo | Reto Abdominal, M√∫sculos da Coluna | Deitado, comece a enrolar o corpo para cima, v√©rtebra por v√©rtebra, formando um 'C' com a coluna para alcan√ßar os p√©s. Role lentamente de volta. | O controle do movimento √© primordial. Use a for√ßa abdominal (e n√£o o impulso) para subir e descer de forma suave, articulando a coluna.",
            "Single Leg Stretch | Pilates | Mat/Solo | Core, Estabilizadores da Pelve | Deitado, levante a cabe√ßa. Puxe um joelho em dire√ß√£o ao peito enquanto estica a outra perna. Troque as pernas de forma controlada e fluida. | Mantenha o 'Powerhouse' (Core) engajado para evitar que a pelve balance. O corpo deve permanecer im√≥vel enquanto as pernas se movem.",
            "Teaser | Pilates | Mat/Solo | Reto Abdominal, Flexores do Quadril, Estabilizadores | Sentado, eleve o tronco e as pernas esticadas, formando um 'V' equilibrado. Estique os bra√ßos paralelamente √†s pernas. | A estabilidade do core √© o foco. Encontre o equil√≠brio nos √≠squios. Se for dif√≠cil, mantenha os joelhos dobrados (varia√ß√£o 'Table Top').",
            "Swimming (Nata√ß√£o) | Pilates | Mat/Solo | Paravertebrais (Extensores da Coluna), Gl√∫teos | Deitado de bru√ßos, levante a cabe√ßa. Levante e alterne o bra√ßo e perna opostos (bra√ßo direito/perna esquerda) em um ritmo de 'nata√ß√£o' suave. | Concentre-se no alongamento axial (crescer a coluna) e na ativa√ß√£o dos gl√∫teos. Evite levantar a cabe√ßa ou o tronco demais (hiperextens√£o lombar).",
            "Esteira (Caminhada/Corrida) | Aer√≥bico | Cardio | Quadr√≠ceps, Isquiotibiais, Panturrilhas, Core | Caminhe ou corra em um ritmo constante. A intensidade √© controlada ajustando a velocidade (km/h) ou a inclina√ß√£o (%). | N√£o se incline para a frente ou se agarre nos apoios, pois isso prejudica a postura natural e reduz o gasto cal√≥rico efetivo.",
            "Bicicleta Ergom√©trica (Estacion√°ria) | Aer√≥bico | Cardio | Quadr√≠ceps, Isquiotibiais, Panturrilhas, Gl√∫teos | Pedale em um movimento circular constante. A intensidade √© ajustada pela Resist√™ncia (n√≠vel de carga) e pela RPM (rota√ß√µes por minuto). | Ajuste a altura do selim: o joelho deve estar levemente flexionado no ponto mais baixo do pedal para evitar les√µes e maximizar a efici√™ncia.",
            "El√≠ptico | Aer√≥bico | Cardio | Corpo Inteiro (Quadr√≠ceps, Gl√∫teos, Peitoral, Dorsal) | Posicione os p√©s nas plataformas e agarre as al√ßas. Mova bra√ßos e pernas em um movimento c√≠clico e el√≠ptico. A intensidade √© ajustada pela Resist√™ncia. | Mantenha os calcanhares na plataforma e use os bra√ßos ativamente (puxando e empurrando) para recrutar a parte superior do corpo.",
            "Alongamento de Quadr√≠ceps (Em P√©) | Alongamento | Pernas | Quadr√≠ceps (Reto Femoral e Vasto) | Em p√© e segurando-se em um apoio, dobre o joelho e puxe o tornozelo em dire√ß√£o ao gl√∫teo. Mantenha os joelhos alinhados. | Mantenha o quadril neutro (n√£o empine) para garantir que o alongamento ocorra na parte da frente da coxa, e n√£o na lombar.",
            "Alongamento de Isquiotibiais (Sentado) | Alongamento | Pernas | Isquiotibiais (Posterior da coxa) | Sentado, estique uma perna e dobre a outra. Incline o tronco para frente, a partir do quadril (mantendo a coluna reta), em dire√ß√£o ao p√© esticado. | O alongamento deve ser sentido na parte posterior da coxa. Evite arredondar as costas, focando na flex√£o do quadril.",
            "Tor√ß√£o de Coluna (Deitado) | Alongamento | Core/Lombar/Gl√∫teos | Gl√∫teo M√°ximo, Obl√≠quos, Paravertebrais | Deitado de costas, puxe um joelho dobrado sobre o corpo, em dire√ß√£o ao ch√£o, no lado oposto. Mantenha os ombros no ch√£o. | Use a respira√ß√£o: a cada expira√ß√£o, tente relaxar e aprofundar um pouco mais a tor√ß√£o. Ajuda a aliviar a tens√£o na lombar.",
            "Alongamento de Peitoral na Parede | Alongamento | Peito/Ombros | Peitoral Maior, Delt√≥ide Anterior | Em p√©, coloque a palma da m√£o e o antebra√ßo contra a parede (ou porta) em um √¢ngulo de 90 graus. Gire o tronco para frente, afastando-se da parede. | Mantenha o ombro para baixo (longe da orelha) e sinta o alongamento no peito e na parte da frente do ombro.",
            "Alongamento de Pesco√ßo (Lateral) | Alongamento | Pesco√ßo/Trap√©zio Superior | Trap√©zio Superior, Esternocleidomast√≥ideo | Sentado ou em p√©, incline suavemente a cabe√ßa para um lado, como se quisesse tocar a orelha no ombro. Use a m√£o do lado oposto para dar um leve pux√£o (se necess√°rio). | Fa√ßa o movimento lentamente. Relaxe o ombro que est√° sendo alongado (oposto) para maximizar o efeito.",
            "Prote√≠na | Nutri√ß√£o | Macronutriente | Constru√ß√£o e Reparo Muscular | Essencial para a s√≠ntese de prote√≠nas musculares (Hipertrofia) e para o reparo das microles√µes geradas durante o treino de for√ßa. | Ingest√£o adequada (principalmente em doses p√≥s-treino) √© vital para otimizar a recupera√ß√£o e o crescimento muscular. ",
            "Carboidrato | Nutri√ß√£o | Macronutriente | Fonte de Energia Prim√°ria (Glicog√™nio) | Principal combust√≠vel para exerc√≠cios de alta intensidade e longa dura√ß√£o. Armazenado como glicog√™nio no f√≠gado e nos m√∫sculos. | O consumo pr√©-treino fornece energia e o p√≥s-treino √© crucial para repor as reservas de glicog√™nio esgotadas.",
            "Gordura (Lip√≠dios) | Nutri√ß√£o | Macronutriente | Reserva de Energia e Produ√ß√£o Hormonal | Serve como fonte de energia para exerc√≠cios de baixa intensidade e dura√ß√£o prolongada. √â fundamental para a produ√ß√£o de horm√¥nios (como a testosterona). | Embora seja fonte de energia, √© vital para a sa√∫de celular, fun√ß√µes cerebrais e absor√ß√£o de vitaminas lipossol√∫veis (A, D, E, K).",
            "Amino√°cidos | Nutri√ß√£o | Micromol√©cula | Bloco Construtor e Anticatabolismo | S√£o os 'tijolos' que comp√µem a prote√≠na. Os BCAAs (ramificados) s√£o particularmente importantes para sinalizar o in√≠cio da s√≠ntese proteica e reduzir a quebra do tecido muscular. | O equil√≠brio de amino√°cidos essenciais (aqueles que o corpo n√£o produz) √© necess√°rio para qualquer processo de reparo e constru√ß√£o muscular.",
            "Dor no Peito (Angina) | Sa√∫de e Alerta | Sintoma Grave | Dor, aperto, queima√ß√£o ou peso no centro do peito que pode irradiar para bra√ßo, pesco√ßo ou mand√≠bula. | Pare imediatamente o exerc√≠cio e procure assist√™ncia m√©dica urgente. Pode ser um sinal de isquemia card√≠aca. | Nunca ignore dor ou desconforto tor√°cico, especialmente se acompanhado de falta de ar ou sudorese.",
            "Tontura ou Vertigem | Sa√∫de e Alerta | Sintoma de Alerta | Sensa√ß√£o de cabe√ßa leve, desmaio iminente ou desequil√≠brio durante o exerc√≠cio. | Pare o exerc√≠cio, sente-se ou deite-se. Beba √°gua e espere a recupera√ß√£o. Pode ser desidrata√ß√£o, hipoglicemia (baixa de a√ß√∫car) ou hipotens√£o (press√£o baixa). | Verifique o n√≠vel de glicose se for diab√©tico e hidrate-se bem antes e durante o treino.",
            "Falta de Ar Anormal | Sa√∫de e Alerta | Sintoma de Alerta | Dificuldade para respirar ou uma sensa√ß√£o de 'f√¥lego incompleto' que √© desproporcional √† intensidade do exerc√≠cio. | Diminua a intensidade drasticamente ou pare. Observe se a respira√ß√£o normaliza rapidamente. Se persistir, procure ajuda. | Pode ser um sinal de problemas pulmonares ou card√≠acos. Atletas com asma devem ter a medica√ß√£o de resgate por perto.",
            "Dor Articular Aguda | Sa√∫de e Alerta | Sintoma de Alerta | Dor s√∫bita e intensa em uma articula√ß√£o (joelho, ombro, cotovelo) que n√£o melhora com a redu√ß√£o de carga. | Interrompa o exerc√≠cio que causa a dor. N√£o tente 'aquecer' ou 'ignorar'. Consulte um profissional para avaliar a les√£o. | Dor muscular √© normal (fadiga); dor articular aguda √© um sinal de les√£o potencial. ",
            "N√°usea e V√¥mito | Sa√∫de e Alerta | Sintoma de Alerta | Sentimento de enjoo ou necessidade de vomitar durante o treino. | Pare o exerc√≠cio e v√° para um local ventilado. Pode ser superaquecimento, desidrata√ß√£o, ou esfor√ßo extremo. | Beba pequenos goles de √°gua. Evite refei√ß√µes pesadas imediatamente antes do treino.",
            "Palpita√ß√µes Irregulares | Sa√∫de e Alerta | Sintoma de Alerta | Sensa√ß√£o de que o cora√ß√£o est√° 'pulando' batidas, batendo muito r√°pido ou de forma desorganizada. | Pare e descanse. Monitore a pulsa√ß√£o. Se for constante, intenso ou acompanhado de tontura, procure assist√™ncia m√©dica. | Arritmias podem ser perigosas. Pacientes com hist√≥rico card√≠aco devem monitorar a frequ√™ncia card√≠aca.",
            "Hipertens√£o (Press√£o Alta) | Doen√ßa Cr√¥nica | Cardiovascular | Manter a press√£o arterial sob controle. | Evite exerc√≠cios isom√©tricos (que exijam muita for√ßa sem movimento, como a prancha m√°xima) e a Manobra de Valsalva (prender a respira√ß√£o durante o levantamento de peso). | Mantenha a respira√ß√£o fluida e evite picos de alta intensidade. Comece com intensidade moderada e mantenha-se hidratado.",
            "Hipotens√£o (Press√£o Baixa) | Doen√ßa Cr√¥nica | Cardiovascular | Evitar tonturas e desmaios (s√≠ncope). | Realize transi√ß√µes de postura lentas (ex: de deitado para em p√©). Aumente a ingest√£o de l√≠quidos (se permitido pelo m√©dico) e sal. | Cuidado especial ao levantar ap√≥s exerc√≠cios no ch√£o (abdominais, alongamentos). A hidrata√ß√£o √© essencial.",
            "Diabetes Tipo 1 e 2 | Doen√ßa Cr√¥nica | Metab√≥lica | Controlar a glicemia e prevenir hipo/hiperglicemia. | Monitore os n√≠veis de glicose antes, durante e ap√≥s o exerc√≠cio. Tenha sempre uma fonte de carboidrato de r√°pida absor√ß√£o (glicose, suco) por perto. | Exerc√≠cios de alta intensidade podem, inicialmente, elevar a glicose (hiperglicemia). O treino moderado geralmente a reduz (hipoglicemia).",
            "Asma | Doen√ßa Cr√¥nica | Pulmonar | Manter a fun√ß√£o respirat√≥ria e prevenir broncoespasmos induzidos pelo exerc√≠cio. | Fa√ßa um bom aquecimento para preparar as vias a√©reas. Evite treinar em ambientes muito frios ou secos, se forem gatilhos. | Tenha sempre o inalador de resgate (broncodilatador) acess√≠vel e use-o preventivamente se necess√°rio, sob orienta√ß√£o m√©dica.",
            "Problemas Articulares (Osteoartrite) | Doen√ßa Cr√¥nica | Musculoesquel√©tica | Fortalecer os m√∫sculos ao redor da articula√ß√£o, minimizando o impacto. | Opte por exerc√≠cios de baixo impacto (nata√ß√£o, bicicleta, el√≠ptico) e controle de carga. Priorize a t√©cnica perfeita sobre o peso. | Evite cargas excessivas e movimentos explosivos. A dor articular √© o limite: se doer, pare e ajuste o movimento."
        ];

        const bancoDeExercicios = {};

        // Processa os dados brutos para criar o objeto de pesquisa otimizado
        rawData.forEach(item => {
            const parts = item.split(' | ');
            if (parts.length === 6) {
                const [nome, modalidade, categoria, musculos, execucao, dica] = parts;

                // Chave prim√°ria (simplificada) para o objeto
                const key = normalize(nome).replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');

                // Gera termos de pesquisa, incluindo palavras de cada campo e termos comuns
                const searchTerms = [
                    ...nome.split(/\s+/).map(normalize),
                    ...musculos.split(/,\s*/).map(normalize).filter(t => t.length > 2),
                    normalize(categoria),
                    normalize(modalidade),
                    normalize(execucao), // Permite buscar por detalhes da execu√ß√£o
                    normalize(dica) // Permite buscar por dicas
                ];

                // Termos especiais para alta relev√¢ncia
                if (nome.includes("Supino")) searchTerms.push("supino", "peito");
                if (nome.includes("Agachamento")) searchTerms.push("agachamento", "agacha", "perna", "gluteo");
                if (nome.includes("Puxada")) searchTerms.push("puxada", "costas", "dorsal");
                if (nome.includes("Remada")) searchTerms.push("remada", "costas");
                if (nome.includes("Rosca")) searchTerms.push("rosca", "biceps");
                if (nome.includes("Tr√≠ceps")) searchTerms.push("triceps", "triceps");
                if (nome.includes("Terra")) searchTerms.push("terra", "stiff", "posterior", "lombar");
                if (nome.includes("Lateral")) searchTerms.push("lateral", "ombro", "deltoide");
                if (nome.includes("Extensora")) searchTerms.push("extensora", "quadriceps");
                if (nome.includes("Press")) searchTerms.push("legpress", "perna");
                if (nome.includes("Plank")) searchTerms.push("prancha", "core", "abdomen");
                if (nome.includes("Dor no Peito")) searchTerms.push("coracao", "infarto", "cardiaco");
                if (nome.includes("Diabetes")) searchTerms.push("glicose", "acucar");

                bancoDeExercicios[key] = {
                    nome: nome,
                    modalidade: modalidade,
                    categoria: categoria,
                    musculos: musculos,
                    execucao: execucao,
                    dica: dica,
                    // Remove duplicatas
                    termos: [...new Set(searchTerms.filter(t => t))]
                };
            }
        });
        // --- FIM DO BANCO DE DADOS LOCAL ---

        function obterNomeAluno() {
            alunoNome = localStorage.getItem('nomeAluno');
            if (!alunoNome) {
                document.getElementById('modal-nome').style.display = 'flex';
            } else {
                start();
            }
        }

        function salvarNomeModal() {
            let n = document.getElementById('nomeModalInput').value.trim();
            if (n) {
                // Formata o nome: Primeira letra de cada palavra em mai√∫scula, resto em min√∫scula
                alunoNome = n.split(' ').map(w => w[0].toUpperCase() + w.slice(1).toLowerCase()).join(' ');
                localStorage.setItem('nomeAluno', alunoNome);
                document.getElementById('modal-nome').style.display = 'none';
                start();
            }
        }

        function start() {
            document.getElementById('nome-aluno').textContent = alunoNome;
            document.getElementById('main-title').textContent = `Bem-vindo, ${alunoNome.split(' ')[0]}!`;
            document.getElementById('data-atual').textContent = new Date().toLocaleDateString('pt-BR');

            inicializarGrafico();
            carregarUltimasMedidas();
            alternarTreino();
            gerarCalendario();
        }

        // üéØ FUN√á√ÉO DE GR√ÅFICO: Implementa√ß√£o robusta
        function inicializarGrafico() {
            const ex = document.getElementById('seletorExercicio').value;
            const nomeExercicioDisplay = document.querySelector(`#seletorExercicio option[value="${ex}"]`).textContent;

            // 1. Destr√≥i a inst√¢ncia anterior para evitar sobreposi√ß√£o ou erros
            if (pesoChart) {
                pesoChart.destroy();
                pesoChart = null;
            }

            const ctx = document.getElementById('pesoChart').getContext('2d');
            // 2. Escuta o Firebase em tempo real (on)
            database.ref(getPath(`cargas/${ex}`)).on('value', snap => {
                const dados = [];
                snap.forEach(d => {
                    const val = d.val();
                    if (val && val.peso !== undefined && val.timestamp) {
                        dados.push(val);
                    }
                });

                // 3. ORDENA OS DADOS PELO TIMESTAMP
                dados.sort((a, b) => a.timestamp - b.timestamp);

                const labels = dados.length ? dados.map(d => d.data) : ['In√≠cio'];
                const pesos = dados.length ? dados.map(d => d.peso) : [0];

                if (pesoChart) {
                    pesoChart.data.labels = labels;
                    pesoChart.data.datasets[0].data = pesos;
                    pesoChart.data.datasets[0].label = `Carga ${nomeExercicioDisplay} (kg)`;
                    pesoChart.update();
                    return;
                }

                // 4. Cria a nova inst√¢ncia do gr√°fico
                pesoChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: `Carga ${nomeExercicioDisplay} (kg)`,
                            data: pesos,
                            borderColor: '#ff8c00',
                            backgroundColor: 'rgba(255,140,0,0.2)',
                            fill: true,
                            tension: 0.3,
                            pointRadius: 5,
                            pointBackgroundColor: '#ff8c00'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: '#333' },
                                ticks: { color: '#f0f0f0' },
                                title: { display: true, text: 'Peso (kg)', color: '#ff8c00' }
                            },
                            x: {
                                grid: { color: '#333' },
                                ticks: { color: '#f0f0f0' }
                            }
                        },
                        plugins: {
                            legend: { labels: { color: '#f0f0f0' } }
                        }
                    }
                });
            });
        }

        // üéØ FUN√á√ÉO DE REGISTRO
        function adicionarPeso() {
            const p = document.getElementById('pesoInput').value;
            if (!p || isNaN(parseFloat(p)) || parseFloat(p) <= 0) {
                alert('Por favor, insira uma carga v√°lida e positiva.');
                return;
            }
            const ex = document.getElementById('seletorExercicio').value;
            const agora = new Date();
            const dataLegivel = agora.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }) +
                ' ' + agora.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            database.ref(getPath(`cargas/${ex}`)).push({
                data: dataLegivel,
                peso: parseFloat(p),
                timestamp: Date.now()
            }).then(() => {
                document.getElementById('pesoInput').value = '';
            }).catch(error => {
                console.error("Erro ao adicionar peso:", error);
                alert("Erro ao registrar carga.");
            });
        }

        // --- MEDIDAS ---
        function registrarMedidas() {
            const peso = document.getElementById('pesoCorporalInput').value;
            if (!peso) return alert('O peso √© obrigat√≥rio!');

            const m = {
                data: new Date().toLocaleDateString('pt-BR'),
                timestamp: Date.now(),
                peso: peso,
                cintura: document.getElementById('cinturaInput').value,
                braco: document.getElementById('bracoInput').value,
                torax: document.getElementById('toraxInput').value,
                abdomen: document.getElementById('abdomenInput').value,
                coxa: document.getElementById('coxaInput').value,
                panturrilha: document.getElementById('panturrilhaInput').value,
                antebraco: document.getElementById('antebracoInput').value
            };
            database.ref(getPath('medidas')).push(m);
            alert('Medidas Salvas!');
            document.querySelectorAll('#medidas-card input').forEach(i => i.value = '');
            carregarUltimasMedidas();
        }

        function carregarUltimasMedidas() {
            database.ref(getPath('medidas')).limitToLast(1).once('value', snap => {
                const div = document.getElementById('ultimasMedidas');
                div.innerHTML = 'Nenhum registro encontrado.';
                snap.forEach(c => {
                    const d = c.val();
                    div.innerHTML =
                        `<strong>${d.data}</strong>: ${d.peso}kg | Cintura: ${d.cintura||'-'} | Bra√ßo: ${d.braco||'-'}`;
                });
            });
        }

        // --- TREINO (CORRIGIDO PARA MANTER A ORDEM) ---
        function alternarTreino() {
            const dia = document.getElementById('seletorTreino').value;
            document.querySelectorAll('.lista-treino-dia').forEach(e => e.style.display = 'none');
            document.getElementById(`treino-${dia}`).style.display = 'block';

            carregarTreinoDoProfessor(dia);
        }

        function marcarConcluido(chk, dia, id) {
            const li = chk.closest('li');
            chk.checked ? li.classList.add('concluido') : li.classList.remove('concluido');
            database.ref(getPath(`treino_status/${dia}/${id}`)).set(chk.checked);
        }

        function carregarCheckboxes(dia) {
            database.ref(getPath(`treino_status/${dia}`)).once('value', snap => {
                const s = snap.val() || {};
                document.getElementById(`treino-${dia}`).querySelectorAll('li').forEach(li => {
                    const id = li.getAttribute('data-exercicio');
                    const chk = li.querySelector('input');
                    if (chk) {
                        if (s[id]) {
                            chk.checked = true;
                            li.classList.add('concluido');
                        } else {
                            chk.checked = false;
                            li.classList.remove('concluido');
                        }
                    }
                });
            });
        }

        function carregarTreinoDoProfessor(dia) {
            const idLista = dia === 'Dia A' ?
                'lista-treino-a' : (dia === 'Dia B' ? 'lista-treino-b' : 'lista-treino-c');
            const ul = document.getElementById(idLista);

            // Remove listener anterior para n√£o duplicar eventos
            database.ref(getPath(`treinoModel/${dia}`)).off('value');

            // Listener novo
            database.ref(getPath(`treinoModel/${dia}`)).on('value', snap => {
                ul.innerHTML = ''; // Limpa a lista antes de adicionar novos itens

                if (!snap.exists()) {
                    ul.innerHTML = '<li class="exercicio-item" style="background: none; border: none; color: #ff9933; border-bottom: 1px dashed rgba(255, 255, 255, 0.2); padding: 10px;">Seu treino ainda n√£o foi enviado.</li>';
                    return;
                }

                // USO DO FOREACH DO SNAPSHOT: Garante a ordem do banco de dados (inser√ß√£o ou array)
                snap.forEach(childSnapshot => {
                    const t = childSnapshot.val();
                    // Verifica se o objeto tem os dados m√≠nimos
                    if (t && t.nome) {
                        const id = t.nome.replace(/\s/g, '');
                        const li = document.createElement('li');
                        li.className = 'exercicio-item';
                        li.setAttribute('data-exercicio', id);
                        li.innerHTML = `
                            <div class="exercicio-info"><strong>${t.nome}</strong><span>${t.series}x | ${t.reps}</span></div>
                            <div class="checkbox-container"><input type="checkbox" onchange="marcarConcluido(this, '${dia}', '${id}')"></div>
                        `;
                        ul.appendChild(li);
                    }
                });

                // Recupera status (checked/unchecked)
                carregarCheckboxes(dia);
            });
        }

        // --- PRESEN√áA ---
        function gerarCalendario() {
            const hoje = new Date();
            const mesAtual = hoje.getMonth();
            const anoAtual = hoje.getFullYear();

            const primeiroDiaSemana = new Date(anoAtual, mesAtual, 1).getDay();
            const ultimoDiaMes = new Date(anoAtual, mesAtual + 1, 0).getDate();

            let html = '<tr>';
            let contadorDias = 1;

            for (let i = 0; i < 6; i++) {
                for (let j = 0; j < 7; j++) {
                    if (i === 0 && j < primeiroDiaSemana) {
                        html += '<td></td>';
                    } else if (contadorDias > ultimoDiaMes) {
                        html += '<td></td>';
                    } else {
                        const chaveData = `${String(contadorDias).padStart(2,'0')}-${String(mesAtual+1).padStart(2,'0')}-${anoAtual}`;
                        html += `<td id="dia-${chaveData}" onclick="togglePresenca('${chaveData}')">${contadorDias}</td>`;
                        contadorDias++;
                    }
                }
                html += '</tr>';
                if (contadorDias > ultimoDiaMes) break;
            }
            document.getElementById('calendario-body').innerHTML = html;
            carregarPresencas();
        }

        function togglePresenca(key) {
            const td = document.getElementById(`dia-${key}`);
            const status = td.classList.contains('presente');
            if (status) {
                database.ref(getPath(`presenca/${key}`)).remove();
                td.classList.remove('presente');
            } else {
                database.ref(getPath(`presenca/${key}`)).set(true);
                td.classList.add('presente');
            }
        }

        function carregarPresencas() {
            database.ref(getPath('presenca')).on('value', snap => {
                const p = snap.val() || {};
                document.querySelectorAll('#calendario-body td').forEach(td => td.classList.remove('presente'));
                Object.keys(p).forEach(k => {
                    const td = document.getElementById(`dia-${k}`);
                    if (td) td.classList.add('presente');
                });
            });
        }

        // --- INTERA√á√ÉO COM IA (FUN√á√ÉO SIMULADA LOCAL) ---
        async function simularPesquisaIA() {
            const pergunta = document.getElementById('exercicioPergunta').value.trim().toLowerCase();
            const perguntaNormalizada = normalize(pergunta);
            const respostaDiv = document.getElementById('ai-resposta');
            const botao = document.querySelector('#ai-search-card .btn-primary');

            // 1. Valida√ß√£o
            if (pergunta.length < 3) {
                respostaDiv.innerHTML = '<strong style="color: #dc3545;">Por favor, digite uma pergunta mais completa.</strong>';
                return;
            }

            // 2. Interface de carregamento
            botao.disabled = true;
            botao.textContent = 'Pesquisando no Banco de Dados... üìö';
            respostaDiv.innerHTML = '<p style="text-align: center; color: #666;">Consultando informa√ß√µes...</p>';

            // Simula um atraso de 1 segundo (para dar a sensa√ß√£o de processamento)
            await new Promise(resolve => setTimeout(resolve, 1000));

            let respostaTexto = '';
            let exercicioEncontrado = null;

            // 3. Busca o Exerc√≠cio pela Palavra-Chave
            for (const key in bancoDeExercicios) {
                const ex = bancoDeExercicios[key];
                // Verifica se a pergunta tem alguma das palavras-chave do exerc√≠cio
                if (ex.termos.some(term => perguntaNormalizada.includes(term))) {
                    exercicioEncontrado = ex;
                    break;
                }
            }

            if (exercicioEncontrado) {
                const nomeEx = exercicioEncontrado.nome;

                // 4. Determina a informa√ß√£o espec√≠fica com base no tipo de dado (Exerc√≠cio vs. Outros)
                if (exercicioEncontrado.categoria === "Sa√∫de e Alerta" || exercicioEncontrado.categoria === "Doen√ßa Cr√¥nica") {
                    // Resposta espec√≠fica para Sa√∫de
                    respostaTexto = `**‚ö†Ô∏è ALERTA DE SA√öDE: ${nomeEx}**\n\n**Sintomas/Defini√ß√£o:** ${exercicioEncontrado.musculos}\n**O que fazer:** ${exercicioEncontrado.execucao}\n**Preven√ß√£o/Dica:** ${exercicioEncontrado.dica}`;
                } else if (exercicioEncontrado.categoria === "Nutri√ß√£o") {
                    // Resposta espec√≠fica para Nutri√ß√£o
                    respostaTexto = `**Informa√ß√£o Nutricional: ${nomeEx}**\n\n**Fun√ß√£o:** ${exercicioEncontrado.musculos}\n**Detalhes:** ${exercicioEncontrado.execucao}\n**Import√¢ncia:** ${exercicioEncontrado.dica}`;
                } else {
                    // Resposta padr√£o para Exerc√≠cios
                    if (perguntaNormalizada.includes("m√∫sculos") || perguntaNormalizada.includes("musculos") || perguntaNormalizada.includes("trabalha") || perguntaNormalizada.includes("ativa")) {
                        respostaTexto = `**M√∫sculos Principais de ${nomeEx}:** ${exercicioEncontrado.musculos}`;
                    } else if (perguntaNormalizada.includes("execu√ß√£o") || perguntaNormalizada.includes("forma correta") || perguntaNormalizada.includes("fazer") || perguntaNormalizada.includes("tecnica")) {
                        respostaTexto = `**Execu√ß√£o do ${nomeEx}:** ${exercicioEncontrado.execucao}\n\n**Dica Importante:** ${exercicioEncontrado.dica}`;
                    } else if (perguntaNormalizada.includes("dica") || perguntaNormalizada.includes("seguran√ßa")) {
                        respostaTexto = `**Dica de Seguran√ßa para ${nomeEx}:** ${exercicioEncontrado.dica}`;
                    } else {
                        // Resumo completo
                        respostaTexto = `**Informa√ß√µes sobre ${nomeEx}**\n\n**Categoria:** ${exercicioEncontrado.categoria}\n**M√∫sculos/Fun√ß√£o:** ${exercicioEncontrado.musculos}\n**Execu√ß√£o/Detalhes:** ${exercicioEncontrado.execucao}\n**Dica:** ${exercicioEncontrado.dica}`;
                    }
                }

            } else {
                // Se nenhum exerc√≠cio foi encontrado
                respostaTexto = `Desculpe, n√£o encontrei informa√ß√µes detalhadas sobre a sua pergunta ("${pergunta}"). Tente pesquisar por um exerc√≠cio espec√≠fico (Ex: Agachamento, Supino), nutri√ß√£o (Ex: Prote√≠na) ou sintoma (Ex: Dor no peito).`;
            }

            // 5. Formata a Resposta (mant√©m o negrito do markdown)
            let respostaFormatada = respostaTexto
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>'); // Substitui quebras de linha por <br>

            respostaDiv.innerHTML = `<div style="text-align: left; padding: 10px;">${respostaFormatada}</div>`;


            // 6. Restaura o bot√£o
            botao.disabled = false;
            botao.textContent = 'Perguntar √† IA';
        }

        // --- RESET GERAL ---
        function resetarDados(tipo) {
            let path;
            let msg;

            switch (tipo) {
                case 'presenca':
                    path = 'presenca';
                    msg = 'hist√≥rico de presen√ßas';
                    break;
                case 'cargas':
                    path = `cargas/${document.getElementById('seletorExercicio').value}`;
                    msg = 'hist√≥rico de cargas para este exerc√≠cio';
                    break;
                case 'medidas':
                    path = 'medidas';
                    msg = 'hist√≥rico de medidas corporais';
                    break;
                default:
                    return;
            }

            if (confirm(`Tem certeza que deseja apagar o ${msg}? Isso n√£o pode ser desfeito.`)) {
                database.ref(getPath(path)).remove()
                    .then(() => {
                        alert('Hist√≥rico apagado com sucesso!');
                        if (tipo === 'presenca') gerarCalendario();
                        if (tipo === 'cargas') inicializarGrafico();
                        if (tipo === 'medidas') document.getElementById('ultimasMedidas').innerHTML = 'Nenhum registro encontrado.';
                    })
                    .catch(error => {
                        console.error("Erro ao resetar dados:", error);
                        alert("Erro ao apagar dados.");
                    });
            }
        }
    </script>
</body>

</html>
